<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>RabbitMq | Levi_Bee's World!</title><meta name="keywords" content="SpringBoot,RabbitMq"><meta name="author" content="Levi_Bee"><meta name="copyright" content="Levi_Bee"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言 所有中间件技术都是基于TCP&#x2F;IP协议基础之上构建新型的协议规范，只不过rabbitMq遵循的是amqp,只要遵循TCP&#x2F;IP就需要IP和Port  学习文档 官方网站 中文文档  代码地址rabbit案例代码 AMQP 1、什么是AMQP  AMQP（Advanced Message Queuing Protocol，高级消息队列协议）是一个进程间传递异步消息的网络协议   2、AMQP模">
<meta property="og:type" content="article">
<meta property="og:title" content="RabbitMq">
<meta property="og:url" content="http://example.com/2022/05/26/%E4%B8%AD%E9%97%B4%E4%BB%B6/RabbitMQ/index.html">
<meta property="og:site_name" content="Levi_Bee&#39;s World!">
<meta property="og:description" content="前言 所有中间件技术都是基于TCP&#x2F;IP协议基础之上构建新型的协议规范，只不过rabbitMq遵循的是amqp,只要遵循TCP&#x2F;IP就需要IP和Port  学习文档 官方网站 中文文档  代码地址rabbit案例代码 AMQP 1、什么是AMQP  AMQP（Advanced Message Queuing Protocol，高级消息队列协议）是一个进程间传递异步消息的网络协议   2、AMQP模">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220526162948004.png">
<meta property="article:published_time" content="2022-05-26T11:00:00.000Z">
<meta property="article:modified_time" content="2022-05-26T08:36:40.985Z">
<meta property="article:author" content="Levi_Bee">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="RabbitMq">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220526162948004.png"><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="http://example.com/2022/05/26/%E4%B8%AD%E9%97%B4%E4%BB%B6/RabbitMQ/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-right"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'RabbitMq',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-26 16:36:40'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mycss.css"><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/IMG_5475.JPG" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/upadte/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page" href="/loving/"><i class="fa-fw fas fa-heart"></i><span> Love</span></a></div><div class="menus_item"><a class="site-page" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> Myself</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220526162948004.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Levi_Bee's World!</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/upadte/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page" href="/loving/"><i class="fa-fw fas fa-heart"></i><span> Love</span></a></div><div class="menus_item"><a class="site-page" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> Myself</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">RabbitMq</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-26T11:00:00.000Z" title="发表于 2022-05-26 19:00:00">2022-05-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-26T08:36:40.985Z" title="更新于 2022-05-26 16:36:40">2022-05-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>40分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="RabbitMq"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>所有中间件技术都是基于<code>TCP/IP</code>协议基础之上构建新型的协议规范，只不过rabbitMq遵循的是<code>amqp</code>,只要遵循<code>TCP/IP</code>就需要<code>IP和Port</code></p>
</blockquote>
<h3 id="学习文档"><a href="#学习文档" class="headerlink" title="学习文档"></a>学习文档</h3><hr>
<p><a target="_blank" rel="noopener" href="https://www.rabbitmq.com/">官方网站</a></p>
<p><a target="_blank" rel="noopener" href="http://rabbitmq.mr-ping.com/">中文文档</a></p>
<hr>
<h3 id="代码地址"><a href="#代码地址" class="headerlink" title="代码地址"></a>代码地址</h3><p><a target="_blank" rel="noopener" href="https://github.com/hellolvweibin/rabbitmq">rabbit案例代码</a></p>
<h3 id="AMQP"><a href="#AMQP" class="headerlink" title="AMQP"></a>AMQP</h3><blockquote>
<h4 id="1、什么是AMQP"><a href="#1、什么是AMQP" class="headerlink" title="1、什么是AMQP"></a>1、什么是AMQP</h4></blockquote>
<ul>
<li>AMQP（Advanced Message Queuing Protocol，高级<a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/cmq?from=10680">消息队列</a>协议）是一个进程间传递异步消息的网络协议</li>
</ul>
<blockquote>
<h4 id="2、AMQP模型"><a href="#2、AMQP模型" class="headerlink" title="2、AMQP模型"></a>2、AMQP模型</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/lwukkklyxb.png" alt="lwukkklyxb"></p>
<blockquote>
<h4 id="可以把AMQP的架构理解为一个邮件服务："><a href="#可以把AMQP的架构理解为一个邮件服务：" class="headerlink" title="可以把AMQP的架构理解为一个邮件服务："></a>可以把AMQP的架构理解为一个邮件服务：</h4></blockquote>
<ul>
<li>一个AMQP消息类似于一封邮件信息</li>
<li>消息队列类似于一个邮箱（Mailbox）</li>
<li>消费者类似一个邮件客户端，能够拉取和删除邮件。</li>
<li>交换器类似一个MTA（邮件服务器）。检查邮件，基于邮件里的路由信息、路由表，来决定如何把邮件发送到一个或多个邮箱里。</li>
<li>Routing Key类似于邮件中的<code>To:</code>，<code>Cc:</code>， <code>Bcc:</code> 的地址。不包含服务端信息。</li>
<li>每一个交换器实例，类似于各个MTA进程。用于处理不同子域名的邮件，或者特定类型的邮件。</li>
<li><code>Binding</code> 类似于MTA中的路由表。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220517161758881.png" alt="image-20220517161758881"></p>
<blockquote>
<h4 id="3、AMQP的核心概念"><a href="#3、AMQP的核心概念" class="headerlink" title="3、AMQP的核心概念"></a>3、AMQP的核心概念</h4></blockquote>
<ul>
<li>Server:又称<strong>Broker</strong>，接受客户端的连接，实现AMQP实体服务</li>
<li>Connection： 连接，应用程序与Broker的网络连接</li>
<li>Chanel：网络通信。几乎所有的操作都是在chanel中进行，Chanel是进行消息的读写通道，一个客户端可以建立多个Chanel，每个Chanel代表一个会话任务</li>
<li>Message:消息，服务器和应用程序之间传递的数据，由Properties和Body组成。Properties可以对消息进行修饰，比如消息的优先级、延迟等高级特性；Body则就是消息体内容</li>
<li>Virtual host:虚拟主机，用于进行逻辑隔离，最上层的消息路由。一个Virtual Host里面可以有若干的Exchange和Queue，同一个Virtual Host里面不能有相同名称的Exchange和Queue</li>
<li>Exchange：交换机，接收消息，根据路由键转发消息到绑定的队列</li>
<li>Binding:Exchange和Queue之间的虚拟链接，binding中可以包含多个routing key</li>
<li>Routing key：一个路由规则，虚拟机可用它来确定如何路由一个特定消息</li>
<li>Queue:也称为Message Queue，消息队列，保存消息并将他们转发给消费者</li>
</ul>
<h2 id="Mac安装RabbitMQ"><a href="#Mac安装RabbitMQ" class="headerlink" title="Mac安装RabbitMQ"></a>Mac安装RabbitMQ</h2><h3 id="使用Docker安装"><a href="#使用Docker安装" class="headerlink" title="使用Docker安装"></a>使用Docker安装</h3><p><a target="_blank" rel="noopener" href="https://hub.docker.com/_/rabbitmq?tab=tags">下载地址</a></p>
<p><strong>使用docker镜像中国下载Rabbitmq镜像，选择带有management的，因为这个是有WEB界面：</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">  levi_bee  ~  #docker pull rabbitmq:3.9-management</span><br><span class="line">3.9-management: Pulling from library/rabbitmq</span><br><span class="line">d4ba87bb7858: Already exists</span><br><span class="line">a29d4fec6504: Already exists</span><br><span class="line">c3deab3c677b: Already exists</span><br><span class="line">e76122cde0e8: Already exists</span><br><span class="line">d39c51cb6cad: Pull complete</span><br><span class="line">02a920f239b9: Pull complete</span><br><span class="line">0e0c020d3d88: Pull complete</span><br><span class="line">959cb17b20c6: Pull complete</span><br><span class="line">cf11f37c53be: Pull complete</span><br><span class="line">3dedd9e4237f: Pull complete</span><br><span class="line">Digest: sha256:1e4f3f71876b3617d2b3b77f1e871df79dfae86d4348113eac99efdfce892ff3</span><br><span class="line">Status: Downloaded newer image for rabbitmq:3.9-management</span><br><span class="line">docker.io/library/rabbitmq:3.9-management</span><br><span class="line"> levi_bee  ~  #docker ps</span><br><span class="line">CONTAINER ID   IMAGE                     COMMAND                  CREATED          STATUS          PORTS                                                                                      NAMES</span><br><span class="line">745deafe5b8b   rabbitmq:3.9-management   &quot;docker-entrypoint.s…&quot;   22 seconds ago   Up 21 seconds   4369/tcp, 5671-5672/tcp, 15672/tcp, 15691-15692/tcp, 25672/tcp, 0.0.0.0:15671-&gt;15671/tcp   rabbitMq</span><br><span class="line"> levi_bee  ~  #docker images</span><br><span class="line">REPOSITORY              TAG              IMAGE ID       CREATED       SIZE</span><br><span class="line">rabbitmq                3.9-management   15ff2479b1d8   5 days ago    221MB</span><br><span class="line">rabbitmq                latest           833a0b14aa8b   5 days ago    189MB</span><br><span class="line">covidvisimage           latest           f14f3894db0e   2 weeks ago   1.55GB</span><br><span class="line">hellolwb                1.0              0bea599dac6b   7 weeks ago   661MB</span><br><span class="line">hellolwb                latest           0bea599dac6b   7 weeks ago   661MB</span><br><span class="line">0bea599dac6b/hellolwb   1.0              0bea599dac6b   7 weeks ago   661MB</span><br><span class="line">tomcat                  latest           2cc8a70b9b1a   8 weeks ago   668MB</span><br><span class="line"> levi_bee  ~  #docker run -d -p 5672:5672 -p 15672:15672 --name rabbitmq 15ff2479b1d8 运行docker中的rabbitmq</span><br><span class="line">4da1516b215d1510752466167c6cdd796d0da292581f579d6e9c1057630be866</span><br><span class="line"> levi_bee  ~  #docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                                                                                                         NAMES</span><br><span class="line">4da1516b215d   15ff2479b1d8   &quot;docker-entrypoint.s…&quot;   7 seconds ago   Up 6 seconds   4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, 15671/tcp, 15691-15692/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp   rabbitmq</span><br><span class="line"> levi_bee  ~  #</span><br></pre></td></tr></table></figure>

<p><strong>此时就可以登录Rabbitmq的WEB界面了，访问地址<a target="_blank" rel="noopener" href="http://localhost:15672/%E6%98%AF%E9%BB%98%E8%AE%A4%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81%E9%83%BD%E6%98%AFguest%E3%80%82">http://localhost:15672/是默认用户名和密码都是guest。</a></strong></p>
<ul>
<li><strong>登录界面：</strong></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/%E6%88%AA%E5%B1%8F2022-05-16%20%E4%B8%8B%E5%8D%882.46.59.png" alt="截屏2022-05-16 下午2.46.59"></p>
<ul>
<li><strong>登录成功后的界面：</strong></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/%E6%88%AA%E5%B1%8F2022-05-16%20%E4%B8%8B%E5%8D%882.48.04.png" alt="截屏2022-05-16 下午2.48.04"></p>
<ul>
<li><strong>消息分发策略的机制和对比</strong></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/%E6%88%AA%E5%B1%8F2022-05-16%20%E4%B8%8B%E5%8D%883.05.11.png" alt="截屏2022-05-16 下午3.05.11"></p>
<h2 id="RabbitMQ-用户操作"><a href="#RabbitMQ-用户操作" class="headerlink" title="RabbitMQ 用户操作"></a>RabbitMQ 用户操作</h2><h3 id="RabbitMQ添加用户"><a href="#RabbitMQ添加用户" class="headerlink" title="RabbitMQ添加用户"></a>RabbitMQ添加用户</h3><ul>
<li><strong>新增一个管理员用户</strong></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/%E6%88%AA%E5%B1%8F2022-05-16%20%E4%B8%8B%E5%8D%883.54.13.png" alt="截屏2022-05-16 下午3.54.13"></p>
<ul>
<li><strong>新增了一个用户</strong></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/%E6%88%AA%E5%B1%8F2022-05-16%20%E4%B8%8B%E5%8D%883.55.42.png" alt="截屏2022-05-16 下午3.55.42"></p>
<h3 id="RabbitMQ-修改用户权限"><a href="#RabbitMQ-修改用户权限" class="headerlink" title="RabbitMQ 修改用户权限"></a>RabbitMQ 修改用户权限</h3><ol>
<li><strong>需要进入到<code>rabbitmq</code>容器当中</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">levi_bee  ~  #docker ps  查看正在运行的rabbitmq容器id</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED             STATUS             PORTS                                                                                                         NAMES</span><br><span class="line">4da1516b215d   15ff2479b1d8   &quot;docker-entrypoint.s…&quot;   About an hour ago   Up About an hour   4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, 15671/tcp, 15691-15692/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp   rabbitmq</span><br><span class="line"> levi_bee  ~  #docker exec -i -t 4da1516b215d bin/bash   进入到rabbitmq容器当中</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>修改用户权限</strong></li>
</ol>
<p>执行命令<code>rabbitmqctl set_permissions -p / admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code> ，注意”/”代表virtual host为“/”这个“/”和linux里的根目录是有区别的并不是virtual host为“/”可以访问所以的virtual host，把这个“/”理解成字符串就行。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@4da1516b215d:/# rabbitmqctl set_permissions -p / admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br><span class="line">Setting permissions for user &quot;admin&quot; in vhost &quot;/&quot; ...</span><br><span class="line">root@4da1516b215d:/#</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>执行后即可WEB端可以看到权限已经修改</strong></li>
</ol>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/%E6%88%AA%E5%B1%8F2022-05-16%20%E4%B8%8B%E5%8D%884.14.57.png" alt="截屏2022-05-16 下午4.14.57"></p>
<h3 id="RabbitMQ-角色分类"><a href="#RabbitMQ-角色分类" class="headerlink" title="RabbitMQ 角色分类"></a>RabbitMQ 角色分类</h3><h4 id="none：类似个人中心"><a href="#none：类似个人中心" class="headerlink" title="none：类似个人中心"></a>none：类似个人中心</h4><ul>
<li>不能访问 management plugin</li>
</ul>
<h4 id="management"><a href="#management" class="headerlink" title="management"></a>management</h4><blockquote>
<p>比个人中心权限高级一点</p>
</blockquote>
<ul>
<li>用户可以通过<strong>AMQP</strong>做的任何事外加：</li>
<li>列出自己可以通过AMQP登入的virtual hosts</li>
<li>查看自己的virtual hosts中的queues, exchanges 和 bindings</li>
<li>查看和关闭自己的channels 和 connections</li>
<li>查看有关自己的virtual hosts的“全局”的统计信息，包含其他用户在这些virtual hosts中的活动。</li>
</ul>
<h4 id="policymaker"><a href="#policymaker" class="headerlink" title="policymaker"></a>policymaker</h4><blockquote>
<p>包含management所有权限</p>
</blockquote>
<ul>
<li>查看、创建和删除自己的virtual hosts所属的policies和parameters</li>
</ul>
<h4 id="monitoring"><a href="#monitoring" class="headerlink" title="monitoring"></a>monitoring</h4><blockquote>
<p>类似管理员，可以看自己和别人的，但是<strong>只能看不能删</strong>;</p>
<p>包含management所有权限</p>
</blockquote>
<ul>
<li>列出所有virtual hosts，包括他们不能登录的virtual hosts</li>
<li>查看其他用户的connections和channels</li>
<li>查看节点级别的数据如clustering和memory使用情况</li>
<li>查看真正的关于所有virtual hosts的全局的统计信息</li>
</ul>
<h4 id="administrator"><a href="#administrator" class="headerlink" title="administrator"></a>administrator</h4><blockquote>
<p>超级管理员，任何权限都有</p>
</blockquote>
<ul>
<li>最高权限</li>
<li>创建和删除virtual hosts</li>
<li>查看、创建和删除users</li>
<li>查看创建和删除permissions</li>
<li>关闭其他用户的connections</li>
</ul>
<h2 id="RabbitMQ-入门案例"><a href="#RabbitMQ-入门案例" class="headerlink" title="RabbitMQ 入门案例"></a>RabbitMQ 入门案例</h2><blockquote>
<h4 id="1、实现步骤"><a href="#1、实现步骤" class="headerlink" title="1、实现步骤"></a>1、实现步骤</h4></blockquote>
<ul>
<li>构建Maven工程</li>
<li>导入rabbitmq依赖</li>
<li>启动rabbitmq-server服务</li>
<li>定义生产者</li>
<li>定义消费者</li>
<li>观察消息在rabbitmq-server服务中的过程</li>
</ul>
<blockquote>
<h4 id="2、构建Maven工程"><a href="#2、构建Maven工程" class="headerlink" title="2、构建Maven工程"></a>2、构建Maven工程</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/%E6%88%AA%E5%B1%8F2022-05-17%20%E4%B8%8B%E5%8D%882.11.58.png" alt="截屏2022-05-17 下午2.11.58"></p>
<blockquote>
<h4 id="3、-导入依赖"><a href="#3、-导入依赖" class="headerlink" title="3、 导入依赖"></a>3、 导入依赖</h4></blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        如果报关于slf4j的错=错误，就导入下面的依赖--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;version&gt;1.7.5&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;version&gt;1.7.5&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br></pre></td></tr></table></figure>



<blockquote>
<h4 id="4、启动rabbitmq-server服务"><a href="#4、启动rabbitmq-server服务" class="headerlink" title="4、启动rabbitmq-server服务"></a>4、启动rabbitmq-server服务</h4></blockquote>
<ul>
<li>树形结构：</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220517150009490.png" alt="image-20220517150009490"></p>
<p><code>Producer.class</code> <strong>生产者</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@Project ：RabbitMq</span></span><br><span class="line"><span class="comment"> *@IDE     ：IntelliJ IDEA</span></span><br><span class="line"><span class="comment"> *@Author  ：Levi_Bee</span></span><br><span class="line"><span class="comment"> *@Date    ：2022/5/17 2:17 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//简单模式Simple</span></span><br><span class="line"><span class="keyword">package</span> com.lv.rabbitmq.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> levi_bee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 创建连接工程</span></span><br><span class="line">        ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        connectionFactory.setHost(<span class="string">&quot;192.168.124.4&quot;</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        connectionFactory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        Connection connection = <span class="keyword">null</span>;</span><br><span class="line">        Channel channel = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//2. 创建连接Connection</span></span><br><span class="line">            connection = connectionFactory.newConnection(<span class="string">&quot;生产者&quot;</span>);</span><br><span class="line">            <span class="comment">//3. 通过连接获取通道Channel</span></span><br><span class="line">            channel = connection.createChannel();</span><br><span class="line">            <span class="comment">//4. 通过创建交换机，声明队列，绑定关系，路由key，发送消息和接收消息</span></span><br><span class="line">            String queueName = <span class="string">&quot;queue1&quot;</span>;</span><br><span class="line">            <span class="comment">/*queueDeclare()实现声明队列</span></span><br><span class="line"><span class="comment">             * @param1:队列的名称</span></span><br><span class="line"><span class="comment">             * @param2:是否要持久化</span></span><br><span class="line"><span class="comment">             * @param3:排他性，即是够独占独立</span></span><br><span class="line"><span class="comment">             * @param4:是够自动删除，随着最后一个消费者消息完成后时候把队列删除</span></span><br><span class="line"><span class="comment">             * @param5:携带附属桉树</span></span><br><span class="line"><span class="comment">             * */</span></span><br><span class="line">            channel.queueDeclare(queueName, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">            <span class="comment">//5. 准备消息内容</span></span><br><span class="line">            String message = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">            <span class="comment">//6. 发送消息给队列Queue</span></span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//7. 关闭通道</span></span><br><span class="line">            <span class="keyword">if</span> (channel != <span class="keyword">null</span> &amp;&amp; channel.isOpen()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    channel.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//8. 关闭连接</span></span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="keyword">null</span> &amp;&amp; connection.isOpen()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220517150205381.png" alt="image-20220517150205381"></p>
<p><code>Consumer.class</code> <strong>消费者</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lv.rabbitmq.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> levi_bee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 创建连接工程</span></span><br><span class="line">        ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        connectionFactory.setHost(<span class="string">&quot;192.168.124.4&quot;</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        connectionFactory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        Connection connection = <span class="keyword">null</span>;</span><br><span class="line">        Channel channel = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//2. 创建连接Connection</span></span><br><span class="line">            connection = connectionFactory.newConnection(<span class="string">&quot;生产者&quot;</span>);</span><br><span class="line">            <span class="comment">//3. 通过连接获取通道Channel</span></span><br><span class="line">            channel = connection.createChannel();</span><br><span class="line">            <span class="comment">//4. 通过创建交换机，声明队列，绑定关系，路由key，发送消息和接收消息</span></span><br><span class="line">            <span class="comment">//下面是和生产者不同的地方</span></span><br><span class="line">            channel.basicConsume(<span class="string">&quot;queue1&quot;</span>, <span class="keyword">true</span>, <span class="keyword">new</span> DeliverCallback() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(String s, Delivery message)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;收到的消息是&quot;</span>+<span class="keyword">new</span> String(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,<span class="keyword">new</span> CancelCallback()&#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span> <span class="params">(String consumerTag)</span></span>&#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;接收失败了。。。&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line">            System.out.println(<span class="string">&quot;开始接收消息&quot;</span>);</span><br><span class="line">            System.in.read(); <span class="comment">//程序阻断</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//7. 关闭通道</span></span><br><span class="line">            <span class="keyword">if</span> (channel != <span class="keyword">null</span> &amp;&amp; channel.isOpen()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    channel.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//8. 关闭连接</span></span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="keyword">null</span> &amp;&amp; connection.isOpen()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="运行结果-1"><a href="#运行结果-1" class="headerlink" title="运行结果"></a>运行结果</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220517153105780.png" alt="image-20220517153105780"></p>
<ul>
<li><strong>发现queue1中的四个消息被消费掉了</strong></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220517153201330.png" alt="image-20220517153201330"></p>
<ul>
<li><code>D</code>代表持久化</li>
</ul>
<blockquote>
<h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><ul>
<li>持久化消息会存盘</li>
<li>非持久化信息也会存盘，但随着服务器的重启会丢失</li>
</ul>
</blockquote>
<h2 id="RabbitMQ-支持消息的模式"><a href="#RabbitMQ-支持消息的模式" class="headerlink" title="RabbitMQ 支持消息的模式"></a>RabbitMQ 支持消息的模式</h2><h3 id="简单模式-Hello-World"><a href="#简单模式-Hello-World" class="headerlink" title="简单模式 Hello World!"></a>简单模式 <a target="_blank" rel="noopener" href="https://www.rabbitmq.com/tutorials/tutorial-one-python.html">Hello World!</a></h3><blockquote>
<h5 id="简单模式中不需要指定交换机，是有一个默认的交换机，交换机的类型为direct"><a href="#简单模式中不需要指定交换机，是有一个默认的交换机，交换机的类型为direct" class="headerlink" title="简单模式中不需要指定交换机，是有一个默认的交换机，交换机的类型为direct"></a>简单模式中不需要指定交换机，是有一个默认的交换机，交换机的类型为<code>direct</code></h5><p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220519100115720.png" alt="image-20220519100115720"></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/python-one.png" alt="python-one"></p>
<blockquote>
<h3 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h3><ul>
<li>在消费或者实现预览的时候，不要选择<code>Ack message</code>进行处理，否则会当成真实的消费，消费后会将消息移除，造成数据丢失。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518115500657.png" alt="image-20220518115500657"></p>
</blockquote>
<ol>
<li><strong>创建交换机</strong></li>
</ol>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518120546344.png" alt="image-20220518120546344"></p>
<ol start="2">
<li><strong>增加三个队列queue</strong></li>
</ol>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518120624324.png" alt="image-20220518120624324"></p>
<ol start="3">
<li><strong>把三个队列绑定到交换机</strong>【Binding】</li>
</ol>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518120712772.png" alt="image-20220518120712772"></p>
<ol start="4">
<li><strong>交换机发布消息</strong></li>
</ol>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518120756552.png" alt="image-20220518120756552"></p>
<ol start="5">
<li><strong>查看队列的获得的信息</strong></li>
</ol>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518120910172.png" alt="image-20220518120910172"></p>
<blockquote>
<h3 id="相当于只要绑定了交换机就能收到交换机发送的消息！！！"><a href="#相当于只要绑定了交换机就能收到交换机发送的消息！！！" class="headerlink" title="相当于只要绑定了交换机就能收到交换机发送的消息！！！"></a>相当于只要绑定了交换机就能收到交换机发送的消息！！！</h3></blockquote>
<h3 id="工作模式-Work-queues"><a href="#工作模式-Work-queues" class="headerlink" title="工作模式 Work queues"></a>工作模式 <a target="_blank" rel="noopener" href="https://www.rabbitmq.com/tutorials/tutorial-two-python.html">Work queues</a></h3><blockquote>
<h4 id="自动应答是轮询分发，手动应答是公平分发"><a href="#自动应答是轮询分发，手动应答是公平分发" class="headerlink" title="自动应答是轮询分发，手动应答是公平分发"></a>自动应答是轮询分发，手动应答是公平分发</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/python-two.png" alt="python-two"></p>
<hr>
<ul>
<li><h5 id="当消费者有多个，我们的消息会被那个消费者消费呢，我们应该如何均衡消费者消费消息的多少呢？"><a href="#当消费者有多个，我们的消息会被那个消费者消费呢，我们应该如何均衡消费者消费消息的多少呢？" class="headerlink" title="当消费者有多个，我们的消息会被那个消费者消费呢，我们应该如何均衡消费者消费消息的多少呢？"></a>当消费者有多个，我们的消息会被那个消费者消费呢，我们应该如何均衡消费者消费消息的多少呢？</h5><ul>
<li><strong>主要有两种模式：</strong><ol>
<li>轮询模式的分发：一个消费者一条，按均分配</li>
<li>公平分发：根据消费者的消费能力进行公平分发，处理快的分发多，处理慢的分发少；按劳分配</li>
</ol>
</li>
</ul>
</li>
</ul>
<hr>
<blockquote>
<h4 id="Work模式-轮询模式（Round-Robbin）"><a href="#Work模式-轮询模式（Round-Robbin）" class="headerlink" title="Work模式-轮询模式（Round-Robbin）"></a>Work模式-轮询模式（Round-Robbin）</h4></blockquote>
<ul>
<li><h5 id="特点：该模式接收消息是当有多个消费者接入时，消息的分配模式是一个消费者分配一条，知道消息消费完成"><a href="#特点：该模式接收消息是当有多个消费者接入时，消息的分配模式是一个消费者分配一条，知道消息消费完成" class="headerlink" title="特点：该模式接收消息是当有多个消费者接入时，消息的分配模式是一个消费者分配一条，知道消息消费完成"></a>特点：该模式接收消息是当有多个消费者接入时，消息的分配模式是一个消费者分配一条，知道消息消费完成</h5></li>
</ul>
<h3 id="发布订阅模式-Publish-Subscribe"><a href="#发布订阅模式-Publish-Subscribe" class="headerlink" title="发布订阅模式 Publish/Subscribe"></a>发布订阅模式 <a target="_blank" rel="noopener" href="https://www.rabbitmq.com/tutorials/tutorial-three-python.html">Publish/Subscribe</a></h3><p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/python-three.png" alt="python-three"></p>
<ul>
<li><h4 id="发布订阅模式具体实现"><a href="#发布订阅模式具体实现" class="headerlink" title="发布订阅模式具体实现"></a>发布订阅模式具体实现</h4><ul>
<li><h5 id="类型：fanout（相当于广播模式）"><a href="#类型：fanout（相当于广播模式）" class="headerlink" title="类型：fanout（相当于广播模式）"></a>类型：fanout（相当于广播模式）</h5></li>
<li><h5 id="特点：Fanout—–发布订阅模式。是一种广播机制，他是没有routing-key的模式"><a href="#特点：Fanout—–发布订阅模式。是一种广播机制，他是没有routing-key的模式" class="headerlink" title="特点：Fanout—–发布订阅模式。是一种广播机制，他是没有routing key的模式"></a>特点：Fanout—–发布订阅模式。是一种广播机制，他是没有<code>routing key</code>的模式</h5></li>
</ul>
</li>
</ul>
<blockquote>
<h4 id="生产者"><a href="#生产者" class="headerlink" title="生产者"></a>生产者</h4></blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@Project ：rabbitmq</span></span><br><span class="line"><span class="comment"> *@IDE     ：IntelliJ IDEA</span></span><br><span class="line"><span class="comment"> *@Author  ：Levi_Bee</span></span><br><span class="line"><span class="comment"> *@Date    ：2022/5/19 9:57 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.lv.rabbitmq.routing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> levi_bee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 创建连接工程</span></span><br><span class="line">        ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        connectionFactory.setHost(<span class="string">&quot;192.168.124.4&quot;</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        connectionFactory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        Connection connection = <span class="keyword">null</span>;</span><br><span class="line">        Channel channel = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//2. 创建连接Connection</span></span><br><span class="line">            connection = connectionFactory.newConnection(<span class="string">&quot;生产者&quot;</span>);</span><br><span class="line">            <span class="comment">//3. 通过连接获取通道Channel</span></span><br><span class="line">            channel = connection.createChannel();</span><br><span class="line">            <span class="comment">//4. 通过创建交换机，声明队列，绑定关系，路由key，发送消息和接收消息</span></span><br><span class="line">            String queueName = <span class="string">&quot;queue1&quot;</span>;</span><br><span class="line">            <span class="comment">/*queueDeclare()实现声明队列</span></span><br><span class="line"><span class="comment">             * @param1:队列的名称</span></span><br><span class="line"><span class="comment">             * @param2:是否要持久化</span></span><br><span class="line"><span class="comment">             * @param3:排他性，即是够独占独立</span></span><br><span class="line"><span class="comment">             * @param4:是够自动删除，随着最后一个消费者消息完成后时候把队列删除</span></span><br><span class="line"><span class="comment">             * @param5:携带附属桉树</span></span><br><span class="line"><span class="comment">             * */</span></span><br><span class="line">            <span class="comment">//5. 准备消息内容</span></span><br><span class="line">            String message = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">            <span class="comment">//6. 准备交换机</span></span><br><span class="line">            String exchangeName = <span class="string">&quot;fanout-exchange&quot;</span>;</span><br><span class="line">            <span class="comment">//7. 定义路由key ,因为交换机类型为fanout，所以这里为空</span></span><br><span class="line">            String routeKey = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="comment">//8. 指定交换机的类型</span></span><br><span class="line">            String type = <span class="string">&quot;fanout&quot;</span>;</span><br><span class="line">            <span class="comment">//9. 发送消息给队列Queue</span></span><br><span class="line">            channel.basicPublish(exchangeName, routeKey, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;消息发送成功!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;发送消息出现一场。。。&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//10. 关闭通道</span></span><br><span class="line">            <span class="keyword">if</span> (channel != <span class="keyword">null</span> &amp;&amp; channel.isOpen()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    channel.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//11. 关闭连接</span></span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="keyword">null</span> &amp;&amp; connection.isOpen()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="注意：因为我们在图形化界面中将三个队列已经绑定了，所有这里不用进行绑定，进行发送消息"><a href="#注意：因为我们在图形化界面中将三个队列已经绑定了，所有这里不用进行绑定，进行发送消息" class="headerlink" title="注意：因为我们在图形化界面中将三个队列已经绑定了，所有这里不用进行绑定，进行发送消息"></a>注意：因为我们在图形化界面中将三个队列已经绑定了，所有这里不用进行绑定，进行发送消息</h5></li>
</ul>
<hr>
<ul>
<li><h5 id="点击运行，可以发现三个队列中增加了一条记录"><a href="#点击运行，可以发现三个队列中增加了一条记录" class="headerlink" title="点击运行，可以发现三个队列中增加了一条记录"></a>点击运行，可以发现三个队列中增加了一条记录</h5></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220519102450340.png" alt="image-20220519102450340"></p>
<hr>
<blockquote>
<h4 id="消费者——用线程模拟队列"><a href="#消费者——用线程模拟队列" class="headerlink" title="消费者——用线程模拟队列"></a>消费者——用线程模拟队列</h4></blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@Project ：rabbitmq</span></span><br><span class="line"><span class="comment"> *@IDE     ：IntelliJ IDEA</span></span><br><span class="line"><span class="comment"> *@Author  ：Levi_Bee</span></span><br><span class="line"><span class="comment"> *@Date    ：2022/5/19 9:57 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.lv.rabbitmq.routing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> levi_bee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//1. 创建连接工程</span></span><br><span class="line">            ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">            connectionFactory.setHost(<span class="string">&quot;192.168.124.4&quot;</span>);</span><br><span class="line">            connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">            connectionFactory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">            connectionFactory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">            connectionFactory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">            <span class="comment">//获取队列名称</span></span><br><span class="line">            <span class="keyword">final</span> String queueName=Thread.currentThread().getName();</span><br><span class="line">            Connection connection = <span class="keyword">null</span>;</span><br><span class="line">            Channel channel = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//2. 创建连接Connection</span></span><br><span class="line">                connection = connectionFactory.newConnection(<span class="string">&quot;生产者&quot;</span>);</span><br><span class="line">                <span class="comment">//3. 通过连接获取通道Channel</span></span><br><span class="line">                channel = connection.createChannel();</span><br><span class="line"></span><br><span class="line">                <span class="comment">//4. 定义接收消息的回调</span></span><br><span class="line">                Channel finalChannel = channel;</span><br><span class="line">                finalChannel.basicConsume(queueName, <span class="keyword">true</span>, <span class="keyword">new</span> DeliverCallback() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(String s, Delivery message)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;收到的消息是&quot;</span> + <span class="keyword">new</span> String(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="keyword">new</span> CancelCallback() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line">                System.out.println(queueName+<span class="string">&quot;开始接收消息&quot;</span>);</span><br><span class="line">                System.in.read(); <span class="comment">//程序阻断</span></span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//7. 关闭通道</span></span><br><span class="line">                <span class="keyword">if</span> (channel != <span class="keyword">null</span> &amp;&amp; channel.isOpen()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        channel.close();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//8. 关闭连接</span></span><br><span class="line">                <span class="keyword">if</span> (connection != <span class="keyword">null</span> &amp;&amp; connection.isOpen()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        connection.close();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//启动三个线程模拟队列</span></span><br><span class="line">        <span class="keyword">new</span> Thread(runnable,<span class="string">&quot;queue1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(runnable,<span class="string">&quot;queue2&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(runnable,<span class="string">&quot;queue3&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="点击运行"><a href="#点击运行" class="headerlink" title="点击运行"></a>点击运行</h5></li>
</ul>
<hr>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220519102547708.png" alt="image-20220519102547708"></p>
<ul>
<li><h5 id="在网页端发现所有消息都被消费"><a href="#在网页端发现所有消息都被消费" class="headerlink" title="在网页端发现所有消息都被消费"></a>在网页端发现所有消息都被消费</h5></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220519102647453.png" alt="image-20220519102647453"></p>
<ul>
<li><h5 id="生产者重新发送消息，消费者能及时收到消息"><a href="#生产者重新发送消息，消费者能及时收到消息" class="headerlink" title="生产者重新发送消息，消费者能及时收到消息"></a>生产者重新发送消息，消费者能及时收到消息</h5></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220519103017232.png" alt="image-20220519103017232"></p>
<hr>
<h3 id="路由模式-Routing"><a href="#路由模式-Routing" class="headerlink" title="路由模式 Routing"></a>路由模式 Routing</h3><blockquote>
<h4 id="routing-key相当于数据库中的where条件，用于过滤筛选条件，注意交换机需要选择direct"><a href="#routing-key相当于数据库中的where条件，用于过滤筛选条件，注意交换机需要选择direct" class="headerlink" title="routing key相当于数据库中的where条件，用于过滤筛选条件，注意交换机需要选择direct"></a><code>routing key</code>相当于数据库中的<code>where</code>条件，用于过滤筛选条件，注意交换机需要选择<code>direct</code></h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/python-four.png" alt="python-four"></p>
<ol>
<li><p><strong>创建交换机</strong></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518122020208.png" alt="image-20220518122020208"></p>
<ol start="2">
<li><strong>绑定队列</strong></li>
</ol>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518122952866.png" alt="image-20220518122952866"></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518123148720.png" alt="image-20220518123148720"></p>
<ol start="3">
<li><strong>向Routing Key发送消息</strong></li>
</ol>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518123254041.png" alt="image-20220518123254041"></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518123342897.png" alt="image-20220518123342897"></p>
<p> <img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518123705154.png" alt="image-20220518123705154"></p>
</li>
</ol>
<h3 id="主题模式-Topics"><a href="#主题模式-Topics" class="headerlink" title="主题模式 Topics"></a>主题模式 <a target="_blank" rel="noopener" href="https://www.rabbitmq.com/tutorials/tutorial-five-python.html">Topics</a></h3><blockquote>
<h4 id="Topic模式是模糊匹配模式"><a href="#Topic模式是模糊匹配模式" class="headerlink" title="Topic模式是模糊匹配模式"></a>Topic模式是模糊匹配模式</h4><ul>
<li><code>#</code>代表0个，一个或者多个，多级目录，可有可无</li>
<li><code>*</code>表示只匹配一个词，代表一级，必须要存在</li>
</ul>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/python-five.png" alt="python-five"></p>
<ol>
<li><strong>创建交换机</strong></li>
</ol>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518142606976.png" alt="image-20220518142606976"></p>
<ol start="2">
<li><strong>绑定队列</strong></li>
</ol>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518142638965.png" alt="image-20220518142638965"></p>
<ol start="3">
<li><strong>发布信息</strong></li>
</ol>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518142916497.png" alt="image-20220518142916497"></p>
<blockquote>
<p><strong>发布成功，queue1会接受到来自交换机的信息！</strong></p>
</blockquote>
<ol start="4">
<li><strong>接收消息</strong></li>
</ol>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518143032552.png" alt="image-20220518143032552"></p>
<hr>
<blockquote>
<h3 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h3></blockquote>
<ul>
<li>发送消息</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518143414746.png" alt="image-20220518143414746"></p>
<ul>
<li><strong>如果成功，三个队列都能收到该消息，因为routing key匹配三个队列</strong></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518143459814.png" alt="image-20220518143459814"></p>
<ul>
<li><strong>接收消息</strong></li>
</ul>
<p><img src="RabbitMQ.assets/image-20220518143540304.png" alt="image-20220518143540304"></p>
<blockquote>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4></blockquote>
<ul>
<li><h4 id="生产者-1"><a href="#生产者-1" class="headerlink" title="生产者"></a>生产者</h4></li>
</ul>
<hr>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String exchangeName = <span class="string">&quot;topic-exchange&quot;</span>;</span><br><span class="line"><span class="comment">//7. 定义路由key ,因为交换机类型为fanout，所以这里为空</span></span><br><span class="line">String routeKey = <span class="string">&quot;com.order.test.xxxx&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>按照路由key的关键字，能够匹配的queue1和queue3</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220519134828094.png" alt="image-20220519134828094"></p>
</blockquote>
<hr>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@Project ：rabbitmq</span></span><br><span class="line"><span class="comment"> *@IDE     ：IntelliJ IDEA</span></span><br><span class="line"><span class="comment"> *@Author  ：Levi_Bee</span></span><br><span class="line"><span class="comment"> *@Date    ：2022/5/19 9:57 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.lv.rabbitmq.topics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> levi_bee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 创建连接工程</span></span><br><span class="line">        ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        connectionFactory.setHost(<span class="string">&quot;192.168.124.4&quot;</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        connectionFactory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        Connection connection = <span class="keyword">null</span>;</span><br><span class="line">        Channel channel = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//2. 创建连接Connection</span></span><br><span class="line">            connection = connectionFactory.newConnection(<span class="string">&quot;生产者&quot;</span>);</span><br><span class="line">            <span class="comment">//3. 通过连接获取通道Channel</span></span><br><span class="line">            channel = connection.createChannel();</span><br><span class="line">            <span class="comment">//4. 通过创建交换机，声明队列，绑定关系，路由key，发送消息和接收消息</span></span><br><span class="line">            String queueName = <span class="string">&quot;queue1&quot;</span>;</span><br><span class="line">            <span class="comment">/*queueDeclare()实现声明队列</span></span><br><span class="line"><span class="comment">             * @param1:队列的名称</span></span><br><span class="line"><span class="comment">             * @param2:是否要持久化</span></span><br><span class="line"><span class="comment">             * @param3:排他性，即是够独占独立</span></span><br><span class="line"><span class="comment">             * @param4:是够自动删除，随着最后一个消费者消息完成后时候把队列删除</span></span><br><span class="line"><span class="comment">             * @param5:携带附属桉树</span></span><br><span class="line"><span class="comment">             * */</span></span><br><span class="line">            <span class="comment">//5. 准备消息内容</span></span><br><span class="line">            String message = <span class="string">&quot;Hello Topics!&quot;</span>;</span><br><span class="line">            <span class="comment">//6. 准备交换机</span></span><br><span class="line">            String exchangeName = <span class="string">&quot;topic-exchange&quot;</span>;</span><br><span class="line">            <span class="comment">//7. 定义路由key ,因为交换机类型为fanout，所以这里为空</span></span><br><span class="line">            String routeKey = <span class="string">&quot;com.order.test.xxxx&quot;</span>;</span><br><span class="line">            <span class="comment">//8. 指定交换机的类型</span></span><br><span class="line">            String type = <span class="string">&quot;topic&quot;</span>;</span><br><span class="line">            <span class="comment">//9. 发送消息给队列Queue</span></span><br><span class="line">            channel.basicPublish(exchangeName, routeKey, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;消息发送成功!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;发送消息出现一场。。。&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//10. 关闭通道</span></span><br><span class="line">            <span class="keyword">if</span> (channel != <span class="keyword">null</span> &amp;&amp; channel.isOpen()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    channel.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//11. 关闭连接</span></span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="keyword">null</span> &amp;&amp; connection.isOpen()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li><h4 id="消费者"><a href="#消费者" class="headerlink" title="消费者"></a>消费者</h4></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@Project ：rabbitmq</span></span><br><span class="line"><span class="comment"> *@IDE     ：IntelliJ IDEA</span></span><br><span class="line"><span class="comment"> *@Author  ：Levi_Bee</span></span><br><span class="line"><span class="comment"> *@Date    ：2022/5/19 9:57 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.lv.rabbitmq.topics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> levi_bee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//1. 创建连接工程</span></span><br><span class="line">            ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">            connectionFactory.setHost(<span class="string">&quot;192.168.124.4&quot;</span>);</span><br><span class="line">            connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">            connectionFactory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">            connectionFactory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">            connectionFactory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">            <span class="comment">//获取队列名称</span></span><br><span class="line">            <span class="keyword">final</span> String queueName=Thread.currentThread().getName();</span><br><span class="line">            Connection connection = <span class="keyword">null</span>;</span><br><span class="line">            Channel channel = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//2. 创建连接Connection</span></span><br><span class="line">                connection = connectionFactory.newConnection(<span class="string">&quot;生产者&quot;</span>);</span><br><span class="line">                <span class="comment">//3. 通过连接获取通道Channel</span></span><br><span class="line">                channel = connection.createChannel();</span><br><span class="line"></span><br><span class="line">                <span class="comment">//4. 定义接收消息的回调</span></span><br><span class="line">                Channel finalChannel = channel;</span><br><span class="line">                finalChannel.basicConsume(queueName, <span class="keyword">true</span>, <span class="keyword">new</span> DeliverCallback() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(String s, Delivery message)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                        System.out.println(queueName+<span class="string">&quot;收到的消息是&quot;</span> + <span class="keyword">new</span> String(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="keyword">new</span> CancelCallback() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line">                System.out.println(queueName+<span class="string">&quot;开始接收消息&quot;</span>);</span><br><span class="line">                System.in.read(); <span class="comment">//程序阻断</span></span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//7. 关闭通道</span></span><br><span class="line">                <span class="keyword">if</span> (channel != <span class="keyword">null</span> &amp;&amp; channel.isOpen()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        channel.close();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//8. 关闭连接</span></span><br><span class="line">                <span class="keyword">if</span> (connection != <span class="keyword">null</span> &amp;&amp; connection.isOpen()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        connection.close();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//启动三个线程模拟队列</span></span><br><span class="line">        <span class="keyword">new</span> Thread(runnable,<span class="string">&quot;queue1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(runnable,<span class="string">&quot;queue2&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(runnable,<span class="string">&quot;queue3&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<h5 id="运行结果："><a href="#运行结果：" class="headerlink" title="运行结果："></a>运行结果：</h5><p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220519134902077.png" alt="image-20220519134902077"></p>
</blockquote>
<h2 id="RabbitMQ-代码实现绑定"><a href="#RabbitMQ-代码实现绑定" class="headerlink" title="RabbitMQ 代码实现绑定"></a>RabbitMQ 代码实现绑定</h2><ul>
<li><h4 id="生产者-2"><a href="#生产者-2" class="headerlink" title="生产者"></a>生产者</h4></li>
</ul>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@Project ：rabbitmq</span></span><br><span class="line"><span class="comment"> *@IDE     ：IntelliJ IDEA</span></span><br><span class="line"><span class="comment"> *@Author  ：Levi_Bee</span></span><br><span class="line"><span class="comment"> *@Date    ：2022/5/19 9:57 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.lv.rabbitmq.all;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> levi_bee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 创建连接工程</span></span><br><span class="line">        ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        connectionFactory.setHost(<span class="string">&quot;192.168.124.4&quot;</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        connectionFactory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        Connection connection = <span class="keyword">null</span>;</span><br><span class="line">        Channel channel = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//2. 创建连接Connection</span></span><br><span class="line">            connection = connectionFactory.newConnection(<span class="string">&quot;生产者&quot;</span>);</span><br><span class="line">            <span class="comment">//3. 通过连接获取通道Channel</span></span><br><span class="line">            channel = connection.createChannel();</span><br><span class="line">            <span class="comment">//4. 通过创建交换机，声明队列，绑定关系，路由key，发送消息和接收消息</span></span><br><span class="line">            String queueName = <span class="string">&quot;queue1&quot;</span>;</span><br><span class="line">            <span class="comment">/*queueDeclare()实现声明队列</span></span><br><span class="line"><span class="comment">             * @param1:队列的名称</span></span><br><span class="line"><span class="comment">             * @param2:是否要持久化</span></span><br><span class="line"><span class="comment">             * @param3:排他性，即是够独占独立</span></span><br><span class="line"><span class="comment">             * @param4:是够自动删除，随着最后一个消费者消息完成后时候把队列删除</span></span><br><span class="line"><span class="comment">             * @param5:携带附属桉树</span></span><br><span class="line"><span class="comment">             * */</span></span><br><span class="line">            <span class="comment">//5. 准备消息内容</span></span><br><span class="line">            String message = <span class="string">&quot;Hello Levi_Bee!&quot;</span>;</span><br><span class="line">            <span class="comment">//6. 准备交换机</span></span><br><span class="line">            String exchangeName = <span class="string">&quot;direct_message_exchange&quot;</span>;</span><br><span class="line"><span class="comment">//            //7. 定义路由key ,因为交换机类型为fanout，所以这里为空</span></span><br><span class="line"><span class="comment">//            String routeKey = &quot;&quot;;</span></span><br><span class="line">            <span class="comment">//8. 指定交换机的类型</span></span><br><span class="line">            String exchangeType = <span class="string">&quot;direct&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//声明交换机，注意：如果直接往交换机里面发送消息的话，会报错，需要先声明 ,true代表持久化，重启不丢失</span></span><br><span class="line">            channel.exchangeDeclare(exchangeName, exchangeType, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//声明队列</span></span><br><span class="line">            channel.queueDeclare(<span class="string">&quot;queue5&quot;</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">            channel.queueDeclare(<span class="string">&quot;queue6&quot;</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line">            channel.queueDeclare(<span class="string">&quot;queue7&quot;</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//绑定队列</span></span><br><span class="line"></span><br><span class="line">            channel.queueBind(<span class="string">&quot;queue5&quot;</span>,exchangeName,<span class="string">&quot;order&quot;</span>);</span><br><span class="line">            channel.queueBind(<span class="string">&quot;queue6&quot;</span>,exchangeName,<span class="string">&quot;order&quot;</span>);</span><br><span class="line">            channel.queueBind(<span class="string">&quot;queue7&quot;</span>,exchangeName,<span class="string">&quot;course&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//9. 发送消息给队列Queue</span></span><br><span class="line">            channel.basicPublish(exchangeName, <span class="string">&quot;order&quot;</span>, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;消息发送成功!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;发送消息出现一场。。。&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//10. 关闭通道</span></span><br><span class="line">            <span class="keyword">if</span> (channel != <span class="keyword">null</span> &amp;&amp; channel.isOpen()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    channel.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//11. 关闭连接</span></span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="keyword">null</span> &amp;&amp; connection.isOpen()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><h4 id="消费者-1"><a href="#消费者-1" class="headerlink" title="消费者"></a>消费者</h4></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@Project ：rabbitmq</span></span><br><span class="line"><span class="comment"> *@IDE     ：IntelliJ IDEA</span></span><br><span class="line"><span class="comment"> *@Author  ：Levi_Bee</span></span><br><span class="line"><span class="comment"> *@Date    ：2022/5/19 9:57 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.lv.rabbitmq.all;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> levi_bee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//1. 创建连接工程</span></span><br><span class="line">            ConnectionFactory connectionFactory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">            connectionFactory.setHost(<span class="string">&quot;192.168.124.4&quot;</span>);</span><br><span class="line">            connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">            connectionFactory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">            connectionFactory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">            connectionFactory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">            <span class="comment">//获取队列名称</span></span><br><span class="line">            <span class="keyword">final</span> String queueName=Thread.currentThread().getName();</span><br><span class="line">            Connection connection = <span class="keyword">null</span>;</span><br><span class="line">            Channel channel = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//2. 创建连接Connection</span></span><br><span class="line">                connection = connectionFactory.newConnection(<span class="string">&quot;生产者&quot;</span>);</span><br><span class="line">                <span class="comment">//3. 通过连接获取通道Channel</span></span><br><span class="line">                channel = connection.createChannel();</span><br><span class="line"></span><br><span class="line">                <span class="comment">//4. 定义接收消息的回调</span></span><br><span class="line">                Channel finalChannel = channel;</span><br><span class="line">                finalChannel.basicConsume(queueName, <span class="keyword">true</span>, <span class="keyword">new</span> DeliverCallback() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(String s, Delivery message)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                        System.out.println(queueName+<span class="string">&quot;收到的消息是&quot;</span> + <span class="keyword">new</span> String(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="keyword">new</span> CancelCallback() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line">                System.out.println(queueName+<span class="string">&quot;开始接收消息&quot;</span>);</span><br><span class="line">                System.in.read(); <span class="comment">//程序阻断</span></span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//7. 关闭通道</span></span><br><span class="line">                <span class="keyword">if</span> (channel != <span class="keyword">null</span> &amp;&amp; channel.isOpen()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        channel.close();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//8. 关闭连接</span></span><br><span class="line">                <span class="keyword">if</span> (connection != <span class="keyword">null</span> &amp;&amp; connection.isOpen()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        connection.close();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//启动三个线程模拟队列</span></span><br><span class="line">        <span class="keyword">new</span> Thread(runnable,<span class="string">&quot;queue5&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(runnable,<span class="string">&quot;queue6&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(runnable,<span class="string">&quot;queue7&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<h4 id="点击运行，在客户端界面可以发现声明了三个队列并已经绑定，并且路由key为order的队列收到了消息"><a href="#点击运行，在客户端界面可以发现声明了三个队列并已经绑定，并且路由key为order的队列收到了消息" class="headerlink" title="点击运行，在客户端界面可以发现声明了三个队列并已经绑定，并且路由key为order的队列收到了消息"></a>点击运行，在客户端界面可以发现声明了三个队列并已经绑定，并且路由key为order的队列收到了消息</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220520101240686.png" alt="image-20220520101240686"></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220520101333242.png" alt="image-20220520101333242"></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220520101355063.png" alt="image-20220520101355063"></p>
<blockquote>
<h4 id="运行消费者"><a href="#运行消费者" class="headerlink" title="运行消费者"></a>运行消费者</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220520101907908.png" alt="image-20220520101907908"></p>
<h2 id="RabbtiMQ-使用场景"><a href="#RabbtiMQ-使用场景" class="headerlink" title="RabbtiMQ 使用场景"></a>RabbtiMQ 使用场景</h2><blockquote>
<h4 id="解耦、削峰、异步"><a href="#解耦、削峰、异步" class="headerlink" title="解耦、削峰、异步"></a>解耦、削峰、异步</h4></blockquote>
<h3 id="同步异步问题（串行）"><a href="#同步异步问题（串行）" class="headerlink" title="同步异步问题（串行）"></a>同步异步问题（串行）</h3><ul>
<li>串行方式：将订单信息写入数据库成功后，发送注册邮件，再发送注册短息。以上三个任务全部完成后，返回给客户端.</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20(3).png" alt="未命名文件 (3)"></p>
<ul>
<li><h4 id="代码形式"><a href="#代码形式" class="headerlink" title="代码形式"></a>代码形式</h4></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makeOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//1. 保存订单</span></span><br><span class="line">  orderService.saveOrder();</span><br><span class="line">    <span class="comment">//2. 发送短信服务</span></span><br><span class="line">  messageService.sendSMS(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    <span class="comment">//3. 发送email服务</span></span><br><span class="line">  emailService.sendEmail(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    <span class="comment">//4. 发送APP服务</span></span><br><span class="line">  appervice.sendApp(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="并行方式（异步线程池）"><a href="#并行方式（异步线程池）" class="headerlink" title="并行方式（异步线程池）"></a>并行方式（异步线程池）</h3><ul>
<li>并行方式：将订单信息写入数据库成功后，发送注册邮件的同时，发送注册短信，以上三个任务完成后，返回客户端。并行可以大大节省时间</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20(5).png" alt="未命名文件 (5)"></p>
<blockquote>
<h5 id="缺点：需要自己去维护线程池，持久性、高可靠、高可用都需要自己实现，最重要的是耦合在应用面程序中"><a href="#缺点：需要自己去维护线程池，持久性、高可靠、高可用都需要自己实现，最重要的是耦合在应用面程序中" class="headerlink" title="缺点：需要自己去维护线程池，持久性、高可靠、高可用都需要自己实现，最重要的是耦合在应用面程序中"></a>缺点：需要自己去维护线程池，持久性、高可靠、高可用都需要自己实现，最重要的是耦合在应用面程序中</h5></blockquote>
<h3 id="异步消息队列方式"><a href="#异步消息队列方式" class="headerlink" title="异步消息队列方式"></a>异步消息队列方式</h3><p><strong>好处：</strong></p>
<ul>
<li>完全解耦合，用MQ建立连接</li>
<li>由独立的线程池和运行模型</li>
<li>出现消息可能会丢失，MQ具有持久化功能</li>
<li>如何保证消息的可靠性，死信队列和消息转移等等</li>
<li>如果服务器承受不了，需要自己去写高可用，HA镜像模型高可用</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20(6).png" alt="未命名文件 (6)"></p>
<h2 id="RabbtiMQ–SpringBoot案例–fanout模式"><a href="#RabbtiMQ–SpringBoot案例–fanout模式" class="headerlink" title="RabbtiMQ–SpringBoot案例–fanout模式"></a>RabbtiMQ–SpringBoot案例–fanout模式</h2><ul>
<li><h4 id="面试题：绑定交换机等配置是在消费者比较好还是在生产者比较好？"><a href="#面试题：绑定交换机等配置是在消费者比较好还是在生产者比较好？" class="headerlink" title="面试题：绑定交换机等配置是在消费者比较好还是在生产者比较好？"></a>面试题：绑定交换机等配置是在消费者比较好还是在生产者比较好？</h4></li>
</ul>
<blockquote>
<h5 id="在消费者处绑定比较好，因为消费的时候要存在队列，如果没有则会报错，所以避免绑定不存在的队列，所以声明配置类在消费者处比较好"><a href="#在消费者处绑定比较好，因为消费的时候要存在队列，如果没有则会报错，所以避免绑定不存在的队列，所以声明配置类在消费者处比较好" class="headerlink" title="在消费者处绑定比较好，因为消费的时候要存在队列，如果没有则会报错，所以避免绑定不存在的队列，所以声明配置类在消费者处比较好"></a>在<code>消费者</code>处绑定比较好，因为消费的时候要存在队列，如果没有则会报错，所以避免绑定不存在的队列，所以声明配置类在消费者处比较好</h5></blockquote>
<hr>
<blockquote>
<h4 id="案例流程"><a href="#案例流程" class="headerlink" title="案例流程"></a>案例流程</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/IMG_866702864A63-1.jpeg" alt="IMG_866702864A63-1"></p>
<blockquote>
<p>新建一个SpringBoot项目实现<strong>生产者功能</strong>，导入web、rabbitMq依赖</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220523183001698.png" alt="image-20220523183001698"></p>
<ul>
<li>application.yml</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#服务端口</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置rabbitmq服务</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.124</span><span class="number">.4</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>OrderService</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@Project ：rabbitmq</span></span><br><span class="line"><span class="comment"> *@IDE     ：IntelliJ IDEA</span></span><br><span class="line"><span class="comment"> *@Author  ：Levi_Bee</span></span><br><span class="line"><span class="comment"> *@Description  ：模拟用户下单</span></span><br><span class="line"><span class="comment"> *@Date    ：2022/5/23 6:04 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.lv.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> levi_bee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makeOrder</span><span class="params">(String userId,String productId,<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">        <span class="comment">//1:根据商品id查询库存是否充足</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.保存订单</span></span><br><span class="line"></span><br><span class="line">        String orderId = UUID.randomUUID().toString();</span><br><span class="line">        System.out.println(<span class="string">&quot;订单生成成功。。。&quot;</span>+orderId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 通过MQ来完成消息的分发</span></span><br><span class="line">        <span class="comment">//参数1：交换机   参数2：路由key/queue队列名称 参数3：消息内容</span></span><br><span class="line"></span><br><span class="line">        String exchangeName=<span class="string">&quot;fanout_order_exchange&quot;</span>;</span><br><span class="line">        String routingKey=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        rabbitTemplate.convertAndSend(exchangeName,routingKey,orderId);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>RabbitMqConfig</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@Project ：rabbitmq</span></span><br><span class="line"><span class="comment"> *@IDE     ：IntelliJ IDEA</span></span><br><span class="line"><span class="comment"> *@Author  ：Levi_Bee</span></span><br><span class="line"><span class="comment"> *@Description  ：配置类</span></span><br><span class="line"><span class="comment"> *@Date    ：2022/5/23 6:14 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.lv.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.FanoutExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> levi_bee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitMqConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1. 声明注册fanout模式的交换机</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FanoutExchange <span class="title">fanoutExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FanoutExchange(<span class="string">&quot;fanout_order_exchange&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.声明队列 sms.fanout.queue,email.fanout.queue,duanxin.fanout.queue</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">smsQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;sms.fanout.queue&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">duanxinQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;duanxin.fanout.queue&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">emailQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;email.fanout.queue&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3.完成绑定关系（队列和交换机完成绑定关系）</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">smsBing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(smsQueue()).to(fanoutExchange());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">duanxinBing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(duanxinQueue()).to(fanoutExchange());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">emailBing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(emailQueue()).to(fanoutExchange());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>测试一下</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lv;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lv.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RabbitMqSpringBootApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        orderService.makeOrder(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="number">12</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220523183426198.png" alt="image-20220523183426198"></p>
<blockquote>
<h4 id="查看图形化界面"><a href="#查看图形化界面" class="headerlink" title="查看图形化界面"></a>查看图形化界面</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220523183502563.png" alt="image-20220523183502563"></p>
<ul>
<li>可以看到绑定成功</li>
</ul>
<blockquote>
<p>新建一个SpringBoot项目实现<strong>消费者功能</strong>，导入web、rabbitMq依赖</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220524094209342.png" alt="image-20220524094209342"></p>
<ul>
<li>application.yml</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#服务端口</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置rabbitmq服务</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.124</span><span class="number">.4</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>FanoutDuanxinConsumer</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@Project ：rabbitmq</span></span><br><span class="line"><span class="comment"> *@IDE     ：IntelliJ IDEA</span></span><br><span class="line"><span class="comment"> *@Author  ：Levi_Bee</span></span><br><span class="line"><span class="comment"> *@Description  ：</span></span><br><span class="line"><span class="comment"> *@Date    ：2022/5/24 9:33 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.lv.service.fanout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> levi_bee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//监听队列</span></span><br><span class="line"><span class="meta">@RabbitListener(queues = &#123;&quot;duanxin.fanout.queue&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FanoutDuanxinConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RabbitHandler</span> 消息落脚点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveMessage</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;duanxin-fanout---接收到了订单信息是：---&gt;&quot;</span>+message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>FanoutSMSConsumer</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &#123;&quot;sms.fanout.queue&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FanoutSMSConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RabbitHandler</span> 消息落脚点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveMessage</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SMS-fanout---接收到了订单信息是：---&gt;&quot;</span>+message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>FanoutEmailConsumer</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//监听队列</span></span><br><span class="line"><span class="meta">@RabbitListener(queues = &#123;&quot;email.fanout.queue&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FanoutEmailConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RabbitHandler</span> 消息落脚点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveMessage</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;email-fanout---接收到了订单信息是：---&gt;&quot;</span>+message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<h5 id="别忘了增加-Service注解"><a href="#别忘了增加-Service注解" class="headerlink" title="别忘了增加@Service注解"></a>别忘了增加<code>@Service</code>注解</h5></blockquote>
<ul>
<li>点击运行，消息被消费</li>
</ul>
<p><img src="RabbitMQ.assets/image-20220524095359324.png" alt="image-20220524095359324"></p>
<h2 id="RabbtiMQ–SpringBoot案例–direct模式"><a href="#RabbtiMQ–SpringBoot案例–direct模式" class="headerlink" title="RabbtiMQ–SpringBoot案例–direct模式"></a>RabbtiMQ–SpringBoot案例–direct模式</h2><p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220524103558927.png" alt="image-20220524103558927"></p>
<ul>
<li>DriectRabbitMqConfig(配置类，绑定交换机等)</li>
</ul>
<blockquote>
<h5 id="注意实例Bean中的名称需要不同，不然会报错说bean重复"><a href="#注意实例Bean中的名称需要不同，不然会报错说bean重复" class="headerlink" title="注意实例Bean中的名称需要不同，不然会报错说bean重复"></a>注意实例Bean中的名称需要不同，不然会报错说bean重复</h5></blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *@Project ：rabbitmq</span></span><br><span class="line"><span class="comment"> *@IDE     ：IntelliJ IDEA</span></span><br><span class="line"><span class="comment"> *@Author  ：Levi_Bee</span></span><br><span class="line"><span class="comment"> *@Description  ：配置类</span></span><br><span class="line"><span class="comment"> *@Date    ：2022/5/23 6:14 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.lv.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.DirectExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> levi_bee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DirectRabbitMqConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1. 声明注册direct模式的交换机</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">directExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(<span class="string">&quot;direct_order_exchange&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.声明队列 sms.direct.queue,email.direct.queue,duanxin.direct.queue</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">smsDirectQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;sms.direct.queue&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">duanxinDirectQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;duanxin.direct.queue&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">emailDirectQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;email.direct.queue&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3.完成绑定关系（队列和交换机完成绑定关系）</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">smsDirectBing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(smsDirectQueue()).to(directExchange()).with(<span class="string">&quot;sms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">duanxinDirectBing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(duanxinDirectQueue()).to(directExchange()).with(<span class="string">&quot;duanxin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">emailDirectBing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(emailDirectQueue()).to(directExchange()).with(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>点击启动</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220524104313303.png" alt="image-20220524104313303"></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220524104334239.png" alt="image-20220524104334239"></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220524104400885.png" alt="image-20220524104400885"></p>
<h2 id="RabbtiMQ–SpringBoot案例–Topic模式"><a href="#RabbtiMQ–SpringBoot案例–Topic模式" class="headerlink" title="RabbtiMQ–SpringBoot案例–Topic模式"></a>RabbtiMQ–SpringBoot案例–Topic模式</h2><blockquote>
<h4 id="使用注解绑定"><a href="#使用注解绑定" class="headerlink" title="使用注解绑定"></a>使用注解绑定</h4></blockquote>
<ul>
<li>TopicDuanxinConsumer</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">        value = @Queue(value = &quot;duanxin.topic.queue&quot;, durable = &quot;true&quot;, autoDelete = &quot;false&quot;),</span></span><br><span class="line"><span class="meta">        exchange = @Exchange(value = &quot;topic_order_exchange&quot;,type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">        key=&quot;#.duanxin.#&quot;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopicDuanxinConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RabbitHandler</span> 消息落脚点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveMessage</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;duanxin-direct---接收到了订单信息是：---&gt;&quot;</span>+message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>TopicEmailConsumer</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">        value = @Queue(value = &quot;email.topic.queue&quot;, durable = &quot;true&quot;, autoDelete = &quot;false&quot;),</span></span><br><span class="line"><span class="meta">        exchange = @Exchange(value = &quot;topic_order_exchange&quot;,type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">        key=&quot;*.email.#&quot;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopicEmailConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RabbitHandler</span> 消息落脚点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveMessage</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;email-direct---接收到了订单信息是：---&gt;&quot;</span>+message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>TopicSMSConsumer</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">        value = @Queue(value = &quot;sms.topic.queue&quot;, durable = &quot;true&quot;, autoDelete = &quot;false&quot;),</span></span><br><span class="line"><span class="meta">        exchange = @Exchange(value = &quot;topic_order_exchange&quot;,type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">        key=&quot;#.sms.#&quot;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopicSMSConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RabbitHandler</span> 消息落脚点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SMS-direct---接收到了订单信息是：---&gt;&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="启动消费者主程序"><a href="#启动消费者主程序" class="headerlink" title="启动消费者主程序"></a>启动消费者主程序</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220524153749463.png" alt="image-20220524153749463"></p>
<blockquote>
<h4 id="设置路由key"><a href="#设置路由key" class="headerlink" title="设置路由key"></a>设置路由key</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220524154323136.png" alt="image-20220524154323136"></p>
<blockquote>
<h4 id="新增测试用例发送消息，查看哪个消费者能够消费消息"><a href="#新增测试用例发送消息，查看哪个消费者能够消费消息" class="headerlink" title="新增测试用例发送消息，查看哪个消费者能够消费消息"></a>新增测试用例发送消息，查看哪个消费者能够消费消息</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testTopicOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    orderService.makeOrderTopic(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="number">12</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220524154606358.png" alt="image-20220524154606358"></p>
<ul>
<li>仅有SMS和短信匹配，所以只收到两个</li>
</ul>
<h2 id="RabbtiMQ高级-过期时间TTL"><a href="#RabbtiMQ高级-过期时间TTL" class="headerlink" title="RabbtiMQ高级-过期时间TTL"></a>RabbtiMQ高级-过期时间TTL</h2><ul>
<li>通过队列属性设置</li>
</ul>
<p>在 <code>channel.queueDeclare</code> 方法中加入<code>x-message-ttl</code>参数，这个参数的单位是毫秒。 <strong>原生api</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取连接对象</span></span><br><span class="line">Connection conn = RabbitMQUtil.createConn();</span><br><span class="line"><span class="comment">// 获取连接通道</span></span><br><span class="line">Channel channel = conn.createChannel();</span><br><span class="line">Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;x-message-ttl&quot;</span>,<span class="number">10000</span>);</span><br><span class="line">channel.queueDeclare(<span class="string">&quot;ttl.message.queue&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">true</span>,map);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Queue <span class="title">payQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">      Map&lt;String,Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">      <span class="comment">//设置队列的过期时间</span></span><br><span class="line">      params.put(<span class="string">&quot;x-message-ttl&quot;</span>,<span class="number">10000</span>);</span><br><span class="line">      <span class="comment">//也可以使用下面这种写法</span></span><br><span class="line">      <span class="comment">//QueueBuilder.durable(&quot;ttl-quequ&quot;).ttl(10000).build();</span></span><br><span class="line">      <span class="keyword">return</span> QueueBuilder.durable(<span class="string">&quot;ttl.message.queue&quot;</span>).withArguments(params).build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>设置成功可以看到队列出现<code>TTL</code>标志</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220525100406901.png" alt="image-20220525100406901"></p>
<h2 id="RabbtiMQ高级-死信队列"><a href="#RabbtiMQ高级-死信队列" class="headerlink" title="RabbtiMQ高级-死信队列"></a>RabbtiMQ高级-死信队列</h2><blockquote>
<p><code>DLX ，全称为 Dead-Letter-Exchange</code> ，可以称之为<strong>死信交换机</strong>。当消息在一个队列中变成死信（ dead message ）之后，它能被重新被发送到另一个交换器中，这个交换器就是 DLX ，<strong>绑定 DLX 的队列就称之为死信队列</strong>。</p>
</blockquote>
<p>消息变成死信一般是由于以下几种情况造成的：</p>
<ul>
<li>1、消息过期，也就是笔者在上篇提到的 TTL。消息在队列的存活时间超过所设置的 TTL 时间。</li>
<li>2、消息被拒绝，调用了 <code>channel.basicNack</code> 或 <code>channel.basicReject</code>方法，井且设置 <code>requeue</code> 参数为<code>false</code>。</li>
<li>3、队列的消息达到最大长度。</li>
</ul>
<blockquote>
<p> DLX 也是一个正常的交换器，和一般的交换器没有区别，它能在任何的队列上被指定，实际上就是设置某个队列的属性。当这个队列中存在死信时 <code>RabbitMQ</code> 就会自动地将这个消息新发布到设置的 DLX 上去，进而被路由到另一个队列，即死信队列。可以监听这个队列中的消息、以进行相应的处理。</p>
</blockquote>
<h2 id="RabbtiMQ高级-集群"><a href="#RabbtiMQ高级-集群" class="headerlink" title="RabbtiMQ高级-集群"></a>RabbtiMQ高级-集群</h2><h3 id="使用Docker进行RabbitMq集群的搭建"><a href="#使用Docker进行RabbitMq集群的搭建" class="headerlink" title="使用Docker进行RabbitMq集群的搭建"></a>使用Docker进行RabbitMq集群的搭建</h3><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d231844b9c46">参考链接</a></p>
<blockquote>
<h4 id="这里使用Docker进行RabbitMq集群的搭建"><a href="#这里使用Docker进行RabbitMq集群的搭建" class="headerlink" title="这里使用Docker进行RabbitMq集群的搭建"></a>这里使用Docker进行RabbitMq集群的搭建</h4><p>注意：指定rabbitmq的web管理台的登录账户及密码,admin/admin,rabbitmq的集群必须有相同的<code>erlang的cookie</code></p>
</blockquote>
<blockquote>
<p>这里确保已经pull了rabbitmq </p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220525201942253.png" alt="image-20220525201942253"></p>
</blockquote>
<ul>
<li><h4 id="创建第一个节点"><a href="#创建第一个节点" class="headerlink" title="创建第一个节点"></a>创建第一个节点</h4></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -di --hostname rabbit1 --name myrabbitmq01 -p 15672:15672 -p 5672:5672 -e RABBITMQ_ERLANG_COOKIE=<span class="string">&#x27;rabbitcookie&#x27;</span> -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin 15ff2479b1d8</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><h4 id="创建第二个节点-并与第一个节点通信"><a href="#创建第二个节点-并与第一个节点通信" class="headerlink" title="创建第二个节点,并与第一个节点通信"></a>创建第二个节点,<strong>并与第一个节点通信</strong></h4></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -di --hostname rabbit2 --name myrabbitmq02 -p 15673:15672 -p 5673:5672 --link myrabbitmq01:rabbit1 -e RABBITMQ_ERLANG_COOKIE=<span class="string">&#x27;rabbitcookie&#x27;</span> 15ff2479b1d8</span><br></pre></td></tr></table></figure>

<ul>
<li><h4 id="创建第三个节点-并与第一个-第二个节点通信"><a href="#创建第三个节点-并与第一个-第二个节点通信" class="headerlink" title="创建第三个节点,并与第一个,第二个节点通信"></a>创建第三个节点,并与第一个,第二个节点通信</h4></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -di --hostname rabbit3 --name myrabbitmq03 -p 15674:15672 -p 5674:5672 --link myrabbitmq01:rabbit1 --link myrabbitmq02:rabbit2 -e RABBITMQ_ERLANG_COOKIE=<span class="string">&#x27;rabbitcookie&#x27;</span> 15ff2479b1d8</span><br></pre></td></tr></table></figure>

<ul>
<li><h4 id="Docker-ps查看运行的容器"><a href="#Docker-ps查看运行的容器" class="headerlink" title="Docker ps查看运行的容器"></a>Docker ps查看运行的容器</h4></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220525200719928.png" alt="image-20220525200719928"></p>
<ul>
<li><h4 id="将三个节点添加到集群中-以第一个节点为主节点-进入rabbit1的容器"><a href="#将三个节点添加到集群中-以第一个节点为主节点-进入rabbit1的容器" class="headerlink" title="将三个节点添加到集群中,以第一个节点为主节点,进入rabbit1的容器"></a>将三个节点添加到集群中,以第一个节点为主节点,进入rabbit1的容器</h4></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> levi_bee  ~  <span class="comment">#docker exec -ti f6c9e6b73ccf bash</span></span><br><span class="line"> <span class="comment"># 依次执行命令</span></span><br><span class="line"><span class="comment"># 停止服务</span></span><br><span class="line">root@rabbit1:/<span class="comment"># rabbitmqctl stop_app</span></span><br><span class="line">RABBITMQ_ERLANG_COOKIE env variable support is deprecated and will be REMOVED <span class="keyword">in</span> a future version. Use the <span class="variable">$HOME</span>/.erlang.cookie file or the --erlang-cookie switch instead.</span><br><span class="line">Stopping rabbit application on node rabbit@rabbit1 ...</span><br><span class="line"><span class="comment"># 离开所在的集群</span></span><br><span class="line">root@rabbit1:/<span class="comment"># rabbitmqctl reset</span></span><br><span class="line">RABBITMQ_ERLANG_COOKIE env variable support is deprecated and will be REMOVED <span class="keyword">in</span> a future version. Use the <span class="variable">$HOME</span>/.erlang.cookie file or the --erlang-cookie switch instead.</span><br><span class="line">Resetting node rabbit@rabbit1 ...</span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">root@rabbit1:/<span class="comment"># rabbitmqctl start_app</span></span><br><span class="line">RABBITMQ_ERLANG_COOKIE env variable support is deprecated and will be REMOVED <span class="keyword">in</span> a future version. Use the <span class="variable">$HOME</span>/.erlang.cookie file or the --erlang-cookie switch instead.</span><br><span class="line">Starting node rabbit@rabbit1 ...</span><br><span class="line">root@rabbit1:/<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"> levi_bee  ~ </span><br></pre></td></tr></table></figure>

<ul>
<li><h4 id="进入rabbit2容器"><a href="#进入rabbit2容器" class="headerlink" title="进入rabbit2容器"></a>进入rabbit2容器</h4></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -ti fe7727826bda bash</span><br><span class="line"><span class="comment"># 依次执行命令</span></span><br><span class="line"><span class="comment"># 停止服务</span></span><br><span class="line">rabbitmqctl stop_app</span><br><span class="line"><span class="comment"># 离开所在的集群</span></span><br><span class="line">rabbitmqctl reset</span><br><span class="line"><span class="comment"># 加入集群</span></span><br><span class="line">rabbitmqctl join_cluster rabbit@rabbit1</span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">rabbitmqctl start_app</span><br><span class="line"><span class="comment"># 退出容器</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<ul>
<li><h4 id="进入rabbit3容器"><a href="#进入rabbit3容器" class="headerlink" title="进入rabbit3容器"></a>进入rabbit3容器</h4></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -ti daab12504a1f bash</span><br><span class="line"><span class="comment"># 依次执行命令</span></span><br><span class="line"><span class="comment"># 停止服务</span></span><br><span class="line">rabbitmqctl stop_app</span><br><span class="line"><span class="comment"># 离开所在的集群</span></span><br><span class="line">rabbitmqctl reset</span><br><span class="line"><span class="comment"># 加入集群,ram参数表示内存节点,默认磁盘节点(disc)</span></span><br><span class="line">rabbitmqctl join_cluster --ram rabbit@rabbit1</span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">rabbitmqctl start_app</span><br><span class="line"><span class="comment"># 退出容器</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>



<ul>
<li><h4 id="查看容器集群信息-进入集群中的任意一个节点容器"><a href="#查看容器集群信息-进入集群中的任意一个节点容器" class="headerlink" title="查看容器集群信息,进入集群中的任意一个节点容器"></a>查看容器集群信息,进入集群中的任意一个节点容器</h4></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmqctl cluster_status</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220525201554720.png" alt="image-20220525201554720" style="zoom:50%;" />



<ul>
<li><h4 id="扩展为镜像模式的集群-进入主节点的容器-执行命令-将所有queue都进行镜像-配置不同参数可以选择queue"><a href="#扩展为镜像模式的集群-进入主节点的容器-执行命令-将所有queue都进行镜像-配置不同参数可以选择queue" class="headerlink" title="扩展为镜像模式的集群,进入主节点的容器,执行命令,将所有queue都进行镜像(配置不同参数可以选择queue)"></a>扩展为镜像模式的集群,进入主节点的容器,执行命令,将所有queue都进行镜像(配置不同参数可以选择queue)</h4></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> levi_bee  ~  <span class="comment">#docker exec -ti f6c9e6b73ccf bash</span></span><br><span class="line">root@rabbit1:/<span class="comment"># rabbitmqctl set_policy ha-all &quot;^&quot; &#x27;&#123;&quot;ha-mode&quot;:&quot;all&quot;&#125;&#x27;</span></span><br><span class="line">RABBITMQ_ERLANG_COOKIE env variable support is deprecated and will be REMOVED <span class="keyword">in</span> a future version. Use the <span class="variable">$HOME</span>/.erlang.cookie file or the --erlang-cookie switch instead.</span><br><span class="line">Setting policy <span class="string">&quot;ha-all&quot;</span> <span class="keyword">for</span> pattern <span class="string">&quot;^&quot;</span> to <span class="string">&quot;&#123;&quot;</span>ha-mode<span class="string">&quot;:&quot;</span>all<span class="string">&quot;&#125;&quot;</span> with priority <span class="string">&quot;0&quot;</span> <span class="keyword">for</span> vhost <span class="string">&quot;/&quot;</span> ...</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><h4 id="至此-rabbitmq的镜像集群模式搭建完毕-即使主节点挂了-依然能够运行"><a href="#至此-rabbitmq的镜像集群模式搭建完毕-即使主节点挂了-依然能够运行" class="headerlink" title="至此,rabbitmq的镜像集群模式搭建完毕,即使主节点挂了,依然能够运行"></a>至此,rabbitmq的镜像集群模式搭建完毕,即使主节点挂了,依然能够运行</h4></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220525202817690.png" alt="image-20220525202817690"></p>
<blockquote>
<h4 id="打开网页端查看，可以发现有三个节点"><a href="#打开网页端查看，可以发现有三个节点" class="headerlink" title="打开网页端查看，可以发现有三个节点"></a>打开网页端查看，可以发现有三个节点</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220525201743567.png" alt="image-20220525201743567"></p>
<ul>
<li><h4 id="创建节点可以选择在哪个节点上创建"><a href="#创建节点可以选择在哪个节点上创建" class="headerlink" title="创建节点可以选择在哪个节点上创建"></a>创建节点可以选择在哪个节点上创建</h4></li>
</ul>
<p> <img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220526101024228.png" alt="image-20220526101024228"></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220526101128659.png" alt="image-20220526101128659"></p>
<h2 id="RabbtiMQ高级-分布式事务"><a href="#RabbtiMQ高级-分布式事务" class="headerlink" title="RabbtiMQ高级-分布式事务"></a>RabbtiMQ高级-分布式事务</h2><h3 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1&spm=1001.2101.3001.7020">分布式事务</a>指事务的操作位于不同的节点上，需要保证事务的 ACID 特性。</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220526134149559.png" alt="image-20220526134149559"></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220526134223406.png" alt="image-20220526134223406"></p>
<h3 id="分布式事务的方式"><a href="#分布式事务的方式" class="headerlink" title="分布式事务的方式"></a>分布式事务的方式</h3><h4 id="方式1、两阶段提交（2pc）"><a href="#方式1、两阶段提交（2pc）" class="headerlink" title="方式1、两阶段提交（2pc）"></a>方式1、两阶段提交（2pc）</h4><blockquote>
<p>两阶段提交（Two-phase-commit，2pc） ，通过引入协调者（coordinator）来协调参与者的行为，并最终决定这些参与者是否要真正执行事务</p>
</blockquote>
<ul>
<li><h5 id="准备阶段"><a href="#准备阶段" class="headerlink" title="准备阶段"></a>准备阶段</h5></li>
</ul>
<p><code>协调者询问参与者事务是否执行成功，参与者发回事务执行结果</code></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220526145612556.png" alt="image-20220526145612556"></p>
<ul>
<li><h5 id="提交阶段"><a href="#提交阶段" class="headerlink" title="提交阶段"></a>提交阶段</h5></li>
</ul>
<p><code>如果事务在每个参与者上都执行成功，事务协调者发送通知让参与者提交事务，否则，协调者发送通知让参与者回滚事务。</code></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220526150300371.png" alt="image-20220526150300371"></p>
<blockquote>
<h4 id="注意：在准备阶段，参与只是执行了事务，但还未提交！！只有在提交阶段接收到协调者发来的通知后，才进行提交或者回滚"><a href="#注意：在准备阶段，参与只是执行了事务，但还未提交！！只有在提交阶段接收到协调者发来的通知后，才进行提交或者回滚" class="headerlink" title="注意：在准备阶段，参与只是执行了事务，但还未提交！！只有在提交阶段接收到协调者发来的通知后，才进行提交或者回滚"></a>注意：在准备阶段，参与只是执行了事务，但<code>还未提交</code>！！只有在提交阶段接收到协调者发来的通知后，才进行提交或者<code>回滚</code></h4></blockquote>
<ul>
<li><h5 id="2pc存在问题"><a href="#2pc存在问题" class="headerlink" title="2pc存在问题"></a>2pc存在问题</h5><ul>
<li> <strong>同步阻塞</strong>：所有事务参与者在等待其它参与者响应时，都处于同步阻塞状态，无法进行其它操作</li>
<li><strong>单点问题</strong>：协调者在2pc中起到非常大的作用，发生故障将会造成很大影响，特别是在阶段二发生故障，所有参与者会一直等待状态，无法完成其它操作</li>
<li><strong>数据不一致</strong>：在阶段二，如果协调者只发送了部分commit消息，此时网络发生异常，那么只有部分参与者接收到commit消息，也就是说只有部分参与者提交了事务，使得系统数据不一致</li>
<li><strong>太过保守</strong>：任意一个节点失败就会导致整个事务失败，没有完善的容错机制</li>
</ul>
</li>
</ul>
<h4 id="方式2、补偿事务（TCC）"><a href="#方式2、补偿事务（TCC）" class="headerlink" title="方式2、补偿事务（TCC）"></a>方式2、补偿事务（TCC）</h4><blockquote>
<p>Tcc 其实就是采用的补偿机制，其<code>核心思想</code>是：针对每个操作，都要注册一个与其对应的确认和补偿（撤销）操作，</p>
</blockquote>
<ul>
<li><h5 id="分为三个阶段"><a href="#分为三个阶段" class="headerlink" title="分为三个阶段"></a>分为三个阶段</h5><ul>
<li><code>try阶段</code>：主要是对业务系统做检测及预留资源</li>
<li><code>confirm阶段</code>：主要是对业务系统做确认提交，try阶段执行成功并开始执行confirm阶段时，默认confirm阶段是不会错误的，<strong>即只要try成功，confirm一定成功</strong></li>
<li><code>cancel阶段</code>：主要是在业务执行错误，需要回滚的状态下执行的业务取消，预留资源释放</li>
</ul>
</li>
</ul>
<blockquote>
<h5 id="举例说明"><a href="#举例说明" class="headerlink" title="举例说明"></a>举例说明</h5></blockquote>
<p>张三要向李四转账，思路大概是：我们有一个本地方法，里面依次调用<br>   ① 首先在try阶段，要先调用远程接口把两个人的钱冻结起<br>   ② 在confirm阶段，执行远程调用的转账的操作，转账成功进行解冻<br>   ③ 第二步执行成功，则转账成功，如失败，则调用远程冻结接口对应的解冻方法（cancel）</p>
<blockquote>
<h5 id="优点：跟2pc相比，实现及流程相对简单些，但数据的一致性比2pc要差一些"><a href="#优点：跟2pc相比，实现及流程相对简单些，但数据的一致性比2pc要差一些" class="headerlink" title="优点：跟2pc相比，实现及流程相对简单些，但数据的一致性比2pc要差一些"></a>优点：跟2pc相比，实现及流程相对简单些，但数据的一致性比2pc要差一些</h5></blockquote>
<blockquote>
<h5 id="缺点：第2、3步都有可能失败，Tcc属于应用层的补偿方式，需程序员在实现时写很多补偿代码"><a href="#缺点：第2、3步都有可能失败，Tcc属于应用层的补偿方式，需程序员在实现时写很多补偿代码" class="headerlink" title="缺点：第2、3步都有可能失败，Tcc属于应用层的补偿方式，需程序员在实现时写很多补偿代码"></a>缺点：第2、3步都有可能失败，Tcc属于应用层的补偿方式，需程序员在实现时写很多补偿代码</h5></blockquote>
<h4 id="方式3、本地消息表（异步确保）"><a href="#方式3、本地消息表（异步确保）" class="headerlink" title="方式3、本地消息表（异步确保）"></a>方式3、本地消息表（异步确保）</h4><blockquote>
<h5 id="比如支付宝、微信支付主动查询支付状态，对帐单的形式"><a href="#比如支付宝、微信支付主动查询支付状态，对帐单的形式" class="headerlink" title="比如支付宝、微信支付主动查询支付状态，对帐单的形式"></a>比如支付宝、微信支付主动查询支付状态，对帐单的形式</h5></blockquote>
<ul>
<li>本地消息表与业务数据表处于同一个数据库中，这样就能利用本地事务来保证在对这两个表的操作满足事务特性，并且使用了消息队列来保证最终一致性</li>
</ul>
<blockquote>
<h5 id="操作流程"><a href="#操作流程" class="headerlink" title="操作流程"></a>操作流程</h5></blockquote>
<ol>
<li>在分布式事务操作的一方，完成写业务数据的操作之后，向本地消息表发送一个消息，本地事务能保证这个消息一定会被写入本地消息表中</li>
<li>之后将本地消息表中的消息转发到Kafka等消息队列中，如果转发成功，则将消息从本地消息表中删除，否则继续重新转发</li>
<li>在分布式事务操作的另一方从消息队列中读取一个消息，并执行消息中的操作</li>
</ol>
<ul>
<li><h5 id="优点-一种非常经典的实现，避免了分布式事务，实现了最终一致性"><a href="#优点-一种非常经典的实现，避免了分布式事务，实现了最终一致性" class="headerlink" title="**优点: **一种非常经典的实现，避免了分布式事务，实现了最终一致性"></a>**优点: **一种非常经典的实现，避免了分布式事务，实现了最终一致性</h5></li>
<li><h5 id="缺点-消息表会耦合到业务系统中，如何没有封装好的解决方案，会有很多杂活需要处理"><a href="#缺点-消息表会耦合到业务系统中，如何没有封装好的解决方案，会有很多杂活需要处理" class="headerlink" title="**缺点: **消息表会耦合到业务系统中，如何没有封装好的解决方案，会有很多杂活需要处理"></a>**缺点: **消息表会耦合到业务系统中，如何没有封装好的解决方案，会有很多杂活需要处理</h5></li>
</ul>
<h4 id="方式4、MQ事务消息"><a href="#方式4、MQ事务消息" class="headerlink" title="方式4、MQ事务消息"></a>方式4、MQ事务消息</h4><blockquote>
<h4 id="优点-异步场景、通用性较强、拓展性较高"><a href="#优点-异步场景、通用性较强、拓展性较高" class="headerlink" title="优点:异步场景、通用性较强、拓展性较高"></a>优点:异步场景、通用性较强、拓展性较高</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/IMG_927595CF2061-1.jpeg" alt="IMG_927595CF2061-1"></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/IMG_C78DF47F97FC-1.jpeg" alt="IMG_C78DF47F97FC-1"></p>
<p><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/IMG_2E5CFF0682FF-1.jpeg" alt="IMG_2E5CFF0682FF-1"></p>
<blockquote>
<h5 id="以阿里的RabbitMQ中间件为例，思路大致为"><a href="#以阿里的RabbitMQ中间件为例，思路大致为" class="headerlink" title="以阿里的RabbitMQ中间件为例，思路大致为:"></a>以阿里的RabbitMQ中间件为例，思路大致为:</h5></blockquote>
<ul>
<li><p>第一阶段<code>prepared消息</code>，会拿到消息的地址，第二阶段<code>执行本地事务</code>，第三阶段<code>通过第一阶段拿到的地址去访问消息，并修改消息状态</code></p>
</li>
<li><p>也就是说在业务方法内要想消息队列提交两次请求，一次发送消息和一次确认消息，如果确认消息发送失败了，RabbitMQ会定期扫描消息集群中的事务消息，这时候发现了prepared消息，它会向消息发送者确认，所以生产方需要实现一个check接口，RabbitMQ会根据发送端设置的策略来决定是回滚还是继续发送确认消息，这样就保证了消息发送与本地事务同时成功或同时失效</p>
</li>
<li><h5 id="优点：实现了最终一致性，不需要依赖本地数据库事务"><a href="#优点：实现了最终一致性，不需要依赖本地数据库事务" class="headerlink" title="优点：实现了最终一致性，不需要依赖本地数据库事务"></a><strong>优点：</strong>实现了最终一致性，不需要依赖本地数据库事务</h5></li>
<li><h5 id="缺点：实现难度大，主流MQ不支持，RocketMQ事务消息部分代码也未开源"><a href="#缺点：实现难度大，主流MQ不支持，RocketMQ事务消息部分代码也未开源" class="headerlink" title="缺点：实现难度大，主流MQ不支持，RocketMQ事务消息部分代码也未开源"></a>缺点：实现难度大，主流MQ不支持，RocketMQ事务消息部分代码也未开源</h5></li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><blockquote>
<h5 id="基于MQ的分布式事务解决方案优点"><a href="#基于MQ的分布式事务解决方案优点" class="headerlink" title="基于MQ的分布式事务解决方案优点"></a>基于MQ的分布式事务解决方案优点</h5></blockquote>
<ul>
<li>通用型强</li>
<li>拓展方便</li>
<li>耦合性低，方案成熟</li>
</ul>
<blockquote>
<h5 id="基于MQ的分布式事务解决方案缺点"><a href="#基于MQ的分布式事务解决方案缺点" class="headerlink" title="基于MQ的分布式事务解决方案缺点"></a>基于MQ的分布式事务解决方案缺点</h5></blockquote>
<ul>
<li>基于消息中间件，只适合异步场景</li>
<li>消息会延迟处理，需要业务上能够容忍</li>
</ul>
<blockquote>
<h5 id="建议"><a href="#建议" class="headerlink" title="建议"></a>建议</h5></blockquote>
<ul>
<li>尽量避免分布式事务</li>
<li>尽量将非核心业务做成异步</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Levi_Bee</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/05/26/%E4%B8%AD%E9%97%B4%E4%BB%B6/RabbitMQ/">http://example.com/2022/05/26/中间件/RabbitMQ/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Levi_Bee's World!</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot/">SpringBoot</a><a class="post-meta__tags" href="/tags/RabbitMq/">RabbitMq</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220526162948004.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/05/18/Java/JavaWeb%E5%AD%A6%E4%B9%A0/"><img class="next-cover" src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518155406212.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JavaWeb</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/17/%E6%8C%81%E4%B9%85%E5%B1%82/MyBatis/" title="Mybatis"><img class="cover" src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/%E4%B8%8B%E8%BD%BD.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-17</div><div class="title">Mybatis</div></div></a></div><div><a href="/2022/05/17/Spring/SpringBoot%E5%AD%A6%E4%B9%A0/" title="SpringBoot"><img class="cover" src="https://pic1.zhimg.com/v2-5aed21c8ef45942df927ee57dca6c1e7_1440w.jpg?source=172ae18b" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-17</div><div class="title">SpringBoot</div></div></a></div><div><a href="/2022/05/17/Spring/Swagger/" title="Swagger"><img class="cover" src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220517194333470.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-17</div><div class="title">Swagger</div></div></a></div><div><a href="/2022/05/17/%E5%89%8D%E7%AB%AF/Vue/" title="Vue"><img class="cover" src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/vue.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-17</div><div class="title">Vue</div></div></a></div><div><a href="/2022/05/18/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/White-Jotter-Lv/" title="个人项目--WhiteJotter-Lv(基于SpringBoot+Vue实现的前后端分离项目)"><img class="cover" src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518153233950.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-18</div><div class="title">个人项目--WhiteJotter-Lv(基于SpringBoot+Vue实现的前后端分离项目)</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/IMG_5475.JPG" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Levi_Bee</div><div class="author-info__description">代码🧑🏻‍💻｜烹饪🥙｜运动🏀｜养🐰🐰</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/hellolvweibin"><i class="fab fa-github"></i><span>About Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/hellolvweibin" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:279369954@qq.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">世界很美，抬头看看!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E6%96%87%E6%A1%A3"><span class="toc-number">1.1.</span> <span class="toc-text">学习文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%9C%B0%E5%9D%80"><span class="toc-number">1.2.</span> <span class="toc-text">代码地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AMQP"><span class="toc-number">1.3.</span> <span class="toc-text">AMQP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFAMQP"><span class="toc-number">1.3.1.</span> <span class="toc-text">1、什么是AMQP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81AMQP%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">2、AMQP模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E6%8A%8AAMQP%E7%9A%84%E6%9E%B6%E6%9E%84%E7%90%86%E8%A7%A3%E4%B8%BA%E4%B8%80%E4%B8%AA%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%EF%BC%9A"><span class="toc-number">1.3.3.</span> <span class="toc-text">可以把AMQP的架构理解为一个邮件服务：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81AMQP%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.3.4.</span> <span class="toc-text">3、AMQP的核心概念</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mac%E5%AE%89%E8%A3%85RabbitMQ"><span class="toc-number">2.</span> <span class="toc-text">Mac安装RabbitMQ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Docker%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">使用Docker安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbitMQ-%E7%94%A8%E6%88%B7%E6%93%8D%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">RabbitMQ 用户操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RabbitMQ%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="toc-number">3.1.</span> <span class="toc-text">RabbitMQ添加用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RabbitMQ-%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">3.2.</span> <span class="toc-text">RabbitMQ 修改用户权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RabbitMQ-%E8%A7%92%E8%89%B2%E5%88%86%E7%B1%BB"><span class="toc-number">3.3.</span> <span class="toc-text">RabbitMQ 角色分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#none%EF%BC%9A%E7%B1%BB%E4%BC%BC%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83"><span class="toc-number">3.3.1.</span> <span class="toc-text">none：类似个人中心</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#management"><span class="toc-number">3.3.2.</span> <span class="toc-text">management</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#policymaker"><span class="toc-number">3.3.3.</span> <span class="toc-text">policymaker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#monitoring"><span class="toc-number">3.3.4.</span> <span class="toc-text">monitoring</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#administrator"><span class="toc-number">3.3.5.</span> <span class="toc-text">administrator</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbitMQ-%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">4.</span> <span class="toc-text">RabbitMQ 入门案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.0.1.</span> <span class="toc-text">1、实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%9E%84%E5%BB%BAMaven%E5%B7%A5%E7%A8%8B"><span class="toc-number">4.0.2.</span> <span class="toc-text">2、构建Maven工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">4.0.3.</span> <span class="toc-text">3、 导入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E5%90%AF%E5%8A%A8rabbitmq-server%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.0.4.</span> <span class="toc-text">4、启动rabbitmq-server服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="toc-number">4.0.5.</span> <span class="toc-text">运行结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C-1"><span class="toc-number">4.0.6.</span> <span class="toc-text">运行结果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">注意：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbitMQ-%E6%94%AF%E6%8C%81%E6%B6%88%E6%81%AF%E7%9A%84%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">RabbitMQ 支持消息的模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%A8%A1%E5%BC%8F-Hello-World"><span class="toc-number">5.1.</span> <span class="toc-text">简单模式 Hello World!</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%A8%A1%E5%BC%8F%E4%B8%AD%E4%B8%8D%E9%9C%80%E8%A6%81%E6%8C%87%E5%AE%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%EF%BC%8C%E6%98%AF%E6%9C%89%E4%B8%80%E4%B8%AA%E9%BB%98%E8%AE%A4%E7%9A%84%E4%BA%A4%E6%8D%A2%E6%9C%BA%EF%BC%8C%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E7%B1%BB%E5%9E%8B%E4%B8%BAdirect"><span class="toc-number">5.1.0.1.</span> <span class="toc-text">简单模式中不需要指定交换机，是有一个默认的交换机，交换机的类型为direct</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%9A-1"><span class="toc-number">5.2.</span> <span class="toc-text">注意：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%BD%93%E4%BA%8E%E5%8F%AA%E8%A6%81%E7%BB%91%E5%AE%9A%E4%BA%86%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%B0%B1%E8%83%BD%E6%94%B6%E5%88%B0%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%8F%91%E9%80%81%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%81%EF%BC%81%EF%BC%81"><span class="toc-number">5.3.</span> <span class="toc-text">相当于只要绑定了交换机就能收到交换机发送的消息！！！</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F-Work-queues"><span class="toc-number">5.4.</span> <span class="toc-text">工作模式 Work queues</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%E6%98%AF%E8%BD%AE%E8%AF%A2%E5%88%86%E5%8F%91%EF%BC%8C%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E6%98%AF%E5%85%AC%E5%B9%B3%E5%88%86%E5%8F%91"><span class="toc-number">5.4.1.</span> <span class="toc-text">自动应答是轮询分发，手动应答是公平分发</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BD%93%E6%B6%88%E8%B4%B9%E8%80%85%E6%9C%89%E5%A4%9A%E4%B8%AA%EF%BC%8C%E6%88%91%E4%BB%AC%E7%9A%84%E6%B6%88%E6%81%AF%E4%BC%9A%E8%A2%AB%E9%82%A3%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9%E5%91%A2%EF%BC%8C%E6%88%91%E4%BB%AC%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E5%9D%87%E8%A1%A1%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF%E7%9A%84%E5%A4%9A%E5%B0%91%E5%91%A2%EF%BC%9F"><span class="toc-number">5.4.1.1.</span> <span class="toc-text">当消费者有多个，我们的消息会被那个消费者消费呢，我们应该如何均衡消费者消费消息的多少呢？</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Work%E6%A8%A1%E5%BC%8F-%E8%BD%AE%E8%AF%A2%E6%A8%A1%E5%BC%8F%EF%BC%88Round-Robbin%EF%BC%89"><span class="toc-number">5.4.2.</span> <span class="toc-text">Work模式-轮询模式（Round-Robbin）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%89%B9%E7%82%B9%EF%BC%9A%E8%AF%A5%E6%A8%A1%E5%BC%8F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%E6%98%AF%E5%BD%93%E6%9C%89%E5%A4%9A%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%8E%A5%E5%85%A5%E6%97%B6%EF%BC%8C%E6%B6%88%E6%81%AF%E7%9A%84%E5%88%86%E9%85%8D%E6%A8%A1%E5%BC%8F%E6%98%AF%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E5%88%86%E9%85%8D%E4%B8%80%E6%9D%A1%EF%BC%8C%E7%9F%A5%E9%81%93%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E5%AE%8C%E6%88%90"><span class="toc-number">5.4.2.1.</span> <span class="toc-text">特点：该模式接收消息是当有多个消费者接入时，消息的分配模式是一个消费者分配一条，知道消息消费完成</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F-Publish-Subscribe"><span class="toc-number">5.5.</span> <span class="toc-text">发布订阅模式 Publish&#x2F;Subscribe</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.5.1.</span> <span class="toc-text">发布订阅模式具体实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%EF%BC%9Afanout%EF%BC%88%E7%9B%B8%E5%BD%93%E4%BA%8E%E5%B9%BF%E6%92%AD%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="toc-number">5.5.1.1.</span> <span class="toc-text">类型：fanout（相当于广播模式）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%89%B9%E7%82%B9%EF%BC%9AFanout%E2%80%94%E2%80%93%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%E3%80%82%E6%98%AF%E4%B8%80%E7%A7%8D%E5%B9%BF%E6%92%AD%E6%9C%BA%E5%88%B6%EF%BC%8C%E4%BB%96%E6%98%AF%E6%B2%A1%E6%9C%89routing-key%E7%9A%84%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.5.1.2.</span> <span class="toc-text">特点：Fanout—–发布订阅模式。是一种广播机制，他是没有routing key的模式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">5.5.2.</span> <span class="toc-text">生产者</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%9A%E5%9B%A0%E4%B8%BA%E6%88%91%E4%BB%AC%E5%9C%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E4%B8%AD%E5%B0%86%E4%B8%89%E4%B8%AA%E9%98%9F%E5%88%97%E5%B7%B2%E7%BB%8F%E7%BB%91%E5%AE%9A%E4%BA%86%EF%BC%8C%E6%89%80%E6%9C%89%E8%BF%99%E9%87%8C%E4%B8%8D%E7%94%A8%E8%BF%9B%E8%A1%8C%E7%BB%91%E5%AE%9A%EF%BC%8C%E8%BF%9B%E8%A1%8C%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="toc-number">5.5.2.1.</span> <span class="toc-text">注意：因为我们在图形化界面中将三个队列已经绑定了，所有这里不用进行绑定，进行发送消息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E8%BF%90%E8%A1%8C%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%8F%91%E7%8E%B0%E4%B8%89%E4%B8%AA%E9%98%9F%E5%88%97%E4%B8%AD%E5%A2%9E%E5%8A%A0%E4%BA%86%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="toc-number">5.5.2.2.</span> <span class="toc-text">点击运行，可以发现三个队列中增加了一条记录</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85%E2%80%94%E2%80%94%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%A8%A1%E6%8B%9F%E9%98%9F%E5%88%97"><span class="toc-number">5.5.3.</span> <span class="toc-text">消费者——用线程模拟队列</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E8%BF%90%E8%A1%8C"><span class="toc-number">5.5.3.1.</span> <span class="toc-text">点击运行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8%E7%BD%91%E9%A1%B5%E7%AB%AF%E5%8F%91%E7%8E%B0%E6%89%80%E6%9C%89%E6%B6%88%E6%81%AF%E9%83%BD%E8%A2%AB%E6%B6%88%E8%B4%B9"><span class="toc-number">5.5.3.2.</span> <span class="toc-text">在网页端发现所有消息都被消费</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E9%87%8D%E6%96%B0%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%EF%BC%8C%E6%B6%88%E8%B4%B9%E8%80%85%E8%83%BD%E5%8F%8A%E6%97%B6%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF"><span class="toc-number">5.5.3.3.</span> <span class="toc-text">生产者重新发送消息，消费者能及时收到消息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8F-Routing"><span class="toc-number">5.6.</span> <span class="toc-text">路由模式 Routing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#routing-key%E7%9B%B8%E5%BD%93%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84where%E6%9D%A1%E4%BB%B6%EF%BC%8C%E7%94%A8%E4%BA%8E%E8%BF%87%E6%BB%A4%E7%AD%9B%E9%80%89%E6%9D%A1%E4%BB%B6%EF%BC%8C%E6%B3%A8%E6%84%8F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9C%80%E8%A6%81%E9%80%89%E6%8B%A9direct"><span class="toc-number">5.6.1.</span> <span class="toc-text">routing key相当于数据库中的where条件，用于过滤筛选条件，注意交换机需要选择direct</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%BC%8F-Topics"><span class="toc-number">5.7.</span> <span class="toc-text">主题模式 Topics</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Topic%E6%A8%A1%E5%BC%8F%E6%98%AF%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.7.1.</span> <span class="toc-text">Topic模式是模糊匹配模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%95"><span class="toc-number">5.8.</span> <span class="toc-text">拓展</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.8.1.</span> <span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85-1"><span class="toc-number">5.8.2.</span> <span class="toc-text">生产者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">5.8.3.</span> <span class="toc-text">消费者</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C%EF%BC%9A"><span class="toc-number">5.8.3.1.</span> <span class="toc-text">运行结果：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbitMQ-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E7%BB%91%E5%AE%9A"><span class="toc-number">6.</span> <span class="toc-text">RabbitMQ 代码实现绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85-2"><span class="toc-number">6.0.1.</span> <span class="toc-text">生产者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85-1"><span class="toc-number">6.0.2.</span> <span class="toc-text">消费者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E8%BF%90%E8%A1%8C%EF%BC%8C%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%95%8C%E9%9D%A2%E5%8F%AF%E4%BB%A5%E5%8F%91%E7%8E%B0%E5%A3%B0%E6%98%8E%E4%BA%86%E4%B8%89%E4%B8%AA%E9%98%9F%E5%88%97%E5%B9%B6%E5%B7%B2%E7%BB%8F%E7%BB%91%E5%AE%9A%EF%BC%8C%E5%B9%B6%E4%B8%94%E8%B7%AF%E7%94%B1key%E4%B8%BAorder%E7%9A%84%E9%98%9F%E5%88%97%E6%94%B6%E5%88%B0%E4%BA%86%E6%B6%88%E6%81%AF"><span class="toc-number">6.0.3.</span> <span class="toc-text">点击运行，在客户端界面可以发现声明了三个队列并已经绑定，并且路由key为order的队列收到了消息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">6.0.4.</span> <span class="toc-text">运行消费者</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbtiMQ-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">7.</span> <span class="toc-text">RabbtiMQ 使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E8%80%A6%E3%80%81%E5%89%8A%E5%B3%B0%E3%80%81%E5%BC%82%E6%AD%A5"><span class="toc-number">7.0.1.</span> <span class="toc-text">解耦、削峰、异步</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%E9%97%AE%E9%A2%98%EF%BC%88%E4%B8%B2%E8%A1%8C%EF%BC%89"><span class="toc-number">7.1.</span> <span class="toc-text">同步异步问题（串行）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BD%A2%E5%BC%8F"><span class="toc-number">7.1.1.</span> <span class="toc-text">代码形式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E8%A1%8C%E6%96%B9%E5%BC%8F%EF%BC%88%E5%BC%82%E6%AD%A5%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%89"><span class="toc-number">7.2.</span> <span class="toc-text">并行方式（异步线程池）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9%EF%BC%9A%E9%9C%80%E8%A6%81%E8%87%AA%E5%B7%B1%E5%8E%BB%E7%BB%B4%E6%8A%A4%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E6%8C%81%E4%B9%85%E6%80%A7%E3%80%81%E9%AB%98%E5%8F%AF%E9%9D%A0%E3%80%81%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%BD%E9%9C%80%E8%A6%81%E8%87%AA%E5%B7%B1%E5%AE%9E%E7%8E%B0%EF%BC%8C%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84%E6%98%AF%E8%80%A6%E5%90%88%E5%9C%A8%E5%BA%94%E7%94%A8%E9%9D%A2%E7%A8%8B%E5%BA%8F%E4%B8%AD"><span class="toc-number">7.2.0.1.</span> <span class="toc-text">缺点：需要自己去维护线程池，持久性、高可靠、高可用都需要自己实现，最重要的是耦合在应用面程序中</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%96%B9%E5%BC%8F"><span class="toc-number">7.3.</span> <span class="toc-text">异步消息队列方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbtiMQ%E2%80%93SpringBoot%E6%A1%88%E4%BE%8B%E2%80%93fanout%E6%A8%A1%E5%BC%8F"><span class="toc-number">8.</span> <span class="toc-text">RabbtiMQ–SpringBoot案例–fanout模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9A%E7%BB%91%E5%AE%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%AD%89%E9%85%8D%E7%BD%AE%E6%98%AF%E5%9C%A8%E6%B6%88%E8%B4%B9%E8%80%85%E6%AF%94%E8%BE%83%E5%A5%BD%E8%BF%98%E6%98%AF%E5%9C%A8%E7%94%9F%E4%BA%A7%E8%80%85%E6%AF%94%E8%BE%83%E5%A5%BD%EF%BC%9F"><span class="toc-number">8.0.1.</span> <span class="toc-text">面试题：绑定交换机等配置是在消费者比较好还是在生产者比较好？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8%E6%B6%88%E8%B4%B9%E8%80%85%E5%A4%84%E7%BB%91%E5%AE%9A%E6%AF%94%E8%BE%83%E5%A5%BD%EF%BC%8C%E5%9B%A0%E4%B8%BA%E6%B6%88%E8%B4%B9%E7%9A%84%E6%97%B6%E5%80%99%E8%A6%81%E5%AD%98%E5%9C%A8%E9%98%9F%E5%88%97%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E5%88%99%E4%BC%9A%E6%8A%A5%E9%94%99%EF%BC%8C%E6%89%80%E4%BB%A5%E9%81%BF%E5%85%8D%E7%BB%91%E5%AE%9A%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E9%98%9F%E5%88%97%EF%BC%8C%E6%89%80%E4%BB%A5%E5%A3%B0%E6%98%8E%E9%85%8D%E7%BD%AE%E7%B1%BB%E5%9C%A8%E6%B6%88%E8%B4%B9%E8%80%85%E5%A4%84%E6%AF%94%E8%BE%83%E5%A5%BD"><span class="toc-number">8.0.1.1.</span> <span class="toc-text">在消费者处绑定比较好，因为消费的时候要存在队列，如果没有则会报错，所以避免绑定不存在的队列，所以声明配置类在消费者处比较好</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%B5%81%E7%A8%8B"><span class="toc-number">8.0.2.</span> <span class="toc-text">案例流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2"><span class="toc-number">8.0.3.</span> <span class="toc-text">查看图形化界面</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%AB%E5%BF%98%E4%BA%86%E5%A2%9E%E5%8A%A0-Service%E6%B3%A8%E8%A7%A3"><span class="toc-number">8.0.3.1.</span> <span class="toc-text">别忘了增加@Service注解</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbtiMQ%E2%80%93SpringBoot%E6%A1%88%E4%BE%8B%E2%80%93direct%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.</span> <span class="toc-text">RabbtiMQ–SpringBoot案例–direct模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E5%AE%9E%E4%BE%8BBean%E4%B8%AD%E7%9A%84%E5%90%8D%E7%A7%B0%E9%9C%80%E8%A6%81%E4%B8%8D%E5%90%8C%EF%BC%8C%E4%B8%8D%E7%84%B6%E4%BC%9A%E6%8A%A5%E9%94%99%E8%AF%B4bean%E9%87%8D%E5%A4%8D"><span class="toc-number">9.0.0.1.</span> <span class="toc-text">注意实例Bean中的名称需要不同，不然会报错说bean重复</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbtiMQ%E2%80%93SpringBoot%E6%A1%88%E4%BE%8B%E2%80%93Topic%E6%A8%A1%E5%BC%8F"><span class="toc-number">10.</span> <span class="toc-text">RabbtiMQ–SpringBoot案例–Topic模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E7%BB%91%E5%AE%9A"><span class="toc-number">10.0.1.</span> <span class="toc-text">使用注解绑定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%B6%88%E8%B4%B9%E8%80%85%E4%B8%BB%E7%A8%8B%E5%BA%8F"><span class="toc-number">10.0.2.</span> <span class="toc-text">启动消费者主程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%B7%AF%E7%94%B1key"><span class="toc-number">10.0.3.</span> <span class="toc-text">设置路由key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%EF%BC%8C%E6%9F%A5%E7%9C%8B%E5%93%AA%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%83%BD%E5%A4%9F%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF"><span class="toc-number">10.0.4.</span> <span class="toc-text">新增测试用例发送消息，查看哪个消费者能够消费消息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbtiMQ%E9%AB%98%E7%BA%A7-%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4TTL"><span class="toc-number">11.</span> <span class="toc-text">RabbtiMQ高级-过期时间TTL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbtiMQ%E9%AB%98%E7%BA%A7-%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97"><span class="toc-number">12.</span> <span class="toc-text">RabbtiMQ高级-死信队列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbtiMQ%E9%AB%98%E7%BA%A7-%E9%9B%86%E7%BE%A4"><span class="toc-number">13.</span> <span class="toc-text">RabbtiMQ高级-集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Docker%E8%BF%9B%E8%A1%8CRabbitMq%E9%9B%86%E7%BE%A4%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc-number">13.1.</span> <span class="toc-text">使用Docker进行RabbitMq集群的搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E4%BD%BF%E7%94%A8Docker%E8%BF%9B%E8%A1%8CRabbitMq%E9%9B%86%E7%BE%A4%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc-number">13.1.1.</span> <span class="toc-text">这里使用Docker进行RabbitMq集群的搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9"><span class="toc-number">13.1.2.</span> <span class="toc-text">创建第一个节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%BA%8C%E4%B8%AA%E8%8A%82%E7%82%B9-%E5%B9%B6%E4%B8%8E%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9%E9%80%9A%E4%BF%A1"><span class="toc-number">13.1.3.</span> <span class="toc-text">创建第二个节点,并与第一个节点通信</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%89%E4%B8%AA%E8%8A%82%E7%82%B9-%E5%B9%B6%E4%B8%8E%E7%AC%AC%E4%B8%80%E4%B8%AA-%E7%AC%AC%E4%BA%8C%E4%B8%AA%E8%8A%82%E7%82%B9%E9%80%9A%E4%BF%A1"><span class="toc-number">13.1.4.</span> <span class="toc-text">创建第三个节点,并与第一个,第二个节点通信</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-ps%E6%9F%A5%E7%9C%8B%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">13.1.5.</span> <span class="toc-text">Docker ps查看运行的容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E4%B8%89%E4%B8%AA%E8%8A%82%E7%82%B9%E6%B7%BB%E5%8A%A0%E5%88%B0%E9%9B%86%E7%BE%A4%E4%B8%AD-%E4%BB%A5%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9%E4%B8%BA%E4%B8%BB%E8%8A%82%E7%82%B9-%E8%BF%9B%E5%85%A5rabbit1%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">13.1.6.</span> <span class="toc-text">将三个节点添加到集群中,以第一个节点为主节点,进入rabbit1的容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5rabbit2%E5%AE%B9%E5%99%A8"><span class="toc-number">13.1.7.</span> <span class="toc-text">进入rabbit2容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5rabbit3%E5%AE%B9%E5%99%A8"><span class="toc-number">13.1.8.</span> <span class="toc-text">进入rabbit3容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E9%9B%86%E7%BE%A4%E4%BF%A1%E6%81%AF-%E8%BF%9B%E5%85%A5%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E4%BB%BB%E6%84%8F%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9%E5%AE%B9%E5%99%A8"><span class="toc-number">13.1.9.</span> <span class="toc-text">查看容器集群信息,进入集群中的任意一个节点容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E4%B8%BA%E9%95%9C%E5%83%8F%E6%A8%A1%E5%BC%8F%E7%9A%84%E9%9B%86%E7%BE%A4-%E8%BF%9B%E5%85%A5%E4%B8%BB%E8%8A%82%E7%82%B9%E7%9A%84%E5%AE%B9%E5%99%A8-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4-%E5%B0%86%E6%89%80%E6%9C%89queue%E9%83%BD%E8%BF%9B%E8%A1%8C%E9%95%9C%E5%83%8F-%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%8F%82%E6%95%B0%E5%8F%AF%E4%BB%A5%E9%80%89%E6%8B%A9queue"><span class="toc-number">13.1.10.</span> <span class="toc-text">扩展为镜像模式的集群,进入主节点的容器,执行命令,将所有queue都进行镜像(配置不同参数可以选择queue)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%B3%E6%AD%A4-rabbitmq%E7%9A%84%E9%95%9C%E5%83%8F%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA%E5%AE%8C%E6%AF%95-%E5%8D%B3%E4%BD%BF%E4%B8%BB%E8%8A%82%E7%82%B9%E6%8C%82%E4%BA%86-%E4%BE%9D%E7%84%B6%E8%83%BD%E5%A4%9F%E8%BF%90%E8%A1%8C"><span class="toc-number">13.1.11.</span> <span class="toc-text">至此,rabbitmq的镜像集群模式搭建完毕,即使主节点挂了,依然能够运行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E7%BD%91%E9%A1%B5%E7%AB%AF%E6%9F%A5%E7%9C%8B%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%8F%91%E7%8E%B0%E6%9C%89%E4%B8%89%E4%B8%AA%E8%8A%82%E7%82%B9"><span class="toc-number">13.1.12.</span> <span class="toc-text">打开网页端查看，可以发现有三个节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%8A%82%E7%82%B9%E5%8F%AF%E4%BB%A5%E9%80%89%E6%8B%A9%E5%9C%A8%E5%93%AA%E4%B8%AA%E8%8A%82%E7%82%B9%E4%B8%8A%E5%88%9B%E5%BB%BA"><span class="toc-number">13.1.13.</span> <span class="toc-text">创建节点可以选择在哪个节点上创建</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbtiMQ%E9%AB%98%E7%BA%A7-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="toc-number">14.</span> <span class="toc-text">RabbtiMQ高级-分布式事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-1"><span class="toc-number">14.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">14.2.</span> <span class="toc-text">分布式事务的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F1%E3%80%81%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4%EF%BC%882pc%EF%BC%89"><span class="toc-number">14.2.1.</span> <span class="toc-text">方式1、两阶段提交（2pc）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E9%98%B6%E6%AE%B5"><span class="toc-number">14.2.1.1.</span> <span class="toc-text">准备阶段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E9%98%B6%E6%AE%B5"><span class="toc-number">14.2.1.2.</span> <span class="toc-text">提交阶段</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%9A%E5%9C%A8%E5%87%86%E5%A4%87%E9%98%B6%E6%AE%B5%EF%BC%8C%E5%8F%82%E4%B8%8E%E5%8F%AA%E6%98%AF%E6%89%A7%E8%A1%8C%E4%BA%86%E4%BA%8B%E5%8A%A1%EF%BC%8C%E4%BD%86%E8%BF%98%E6%9C%AA%E6%8F%90%E4%BA%A4%EF%BC%81%EF%BC%81%E5%8F%AA%E6%9C%89%E5%9C%A8%E6%8F%90%E4%BA%A4%E9%98%B6%E6%AE%B5%E6%8E%A5%E6%94%B6%E5%88%B0%E5%8D%8F%E8%B0%83%E8%80%85%E5%8F%91%E6%9D%A5%E7%9A%84%E9%80%9A%E7%9F%A5%E5%90%8E%EF%BC%8C%E6%89%8D%E8%BF%9B%E8%A1%8C%E6%8F%90%E4%BA%A4%E6%88%96%E8%80%85%E5%9B%9E%E6%BB%9A"><span class="toc-number">14.2.2.</span> <span class="toc-text">注意：在准备阶段，参与只是执行了事务，但还未提交！！只有在提交阶段接收到协调者发来的通知后，才进行提交或者回滚</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2pc%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98"><span class="toc-number">14.2.2.1.</span> <span class="toc-text">2pc存在问题</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F2%E3%80%81%E8%A1%A5%E5%81%BF%E4%BA%8B%E5%8A%A1%EF%BC%88TCC%EF%BC%89"><span class="toc-number">14.2.3.</span> <span class="toc-text">方式2、补偿事务（TCC）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E4%B8%BA%E4%B8%89%E4%B8%AA%E9%98%B6%E6%AE%B5"><span class="toc-number">14.2.3.1.</span> <span class="toc-text">分为三个阶段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%E8%AF%B4%E6%98%8E"><span class="toc-number">14.2.3.2.</span> <span class="toc-text">举例说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E7%82%B9%EF%BC%9A%E8%B7%9F2pc%E7%9B%B8%E6%AF%94%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%8F%8A%E6%B5%81%E7%A8%8B%E7%9B%B8%E5%AF%B9%E7%AE%80%E5%8D%95%E4%BA%9B%EF%BC%8C%E4%BD%86%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E6%AF%942pc%E8%A6%81%E5%B7%AE%E4%B8%80%E4%BA%9B"><span class="toc-number">14.2.3.3.</span> <span class="toc-text">优点：跟2pc相比，实现及流程相对简单些，但数据的一致性比2pc要差一些</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9%EF%BC%9A%E7%AC%AC2%E3%80%813%E6%AD%A5%E9%83%BD%E6%9C%89%E5%8F%AF%E8%83%BD%E5%A4%B1%E8%B4%A5%EF%BC%8CTcc%E5%B1%9E%E4%BA%8E%E5%BA%94%E7%94%A8%E5%B1%82%E7%9A%84%E8%A1%A5%E5%81%BF%E6%96%B9%E5%BC%8F%EF%BC%8C%E9%9C%80%E7%A8%8B%E5%BA%8F%E5%91%98%E5%9C%A8%E5%AE%9E%E7%8E%B0%E6%97%B6%E5%86%99%E5%BE%88%E5%A4%9A%E8%A1%A5%E5%81%BF%E4%BB%A3%E7%A0%81"><span class="toc-number">14.2.3.4.</span> <span class="toc-text">缺点：第2、3步都有可能失败，Tcc属于应用层的补偿方式，需程序员在实现时写很多补偿代码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F3%E3%80%81%E6%9C%AC%E5%9C%B0%E6%B6%88%E6%81%AF%E8%A1%A8%EF%BC%88%E5%BC%82%E6%AD%A5%E7%A1%AE%E4%BF%9D%EF%BC%89"><span class="toc-number">14.2.4.</span> <span class="toc-text">方式3、本地消息表（异步确保）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AF%94%E5%A6%82%E6%94%AF%E4%BB%98%E5%AE%9D%E3%80%81%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E4%B8%BB%E5%8A%A8%E6%9F%A5%E8%AF%A2%E6%94%AF%E4%BB%98%E7%8A%B6%E6%80%81%EF%BC%8C%E5%AF%B9%E5%B8%90%E5%8D%95%E7%9A%84%E5%BD%A2%E5%BC%8F"><span class="toc-number">14.2.4.1.</span> <span class="toc-text">比如支付宝、微信支付主动查询支付状态，对帐单的形式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">14.2.4.2.</span> <span class="toc-text">操作流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-%E4%B8%80%E7%A7%8D%E9%9D%9E%E5%B8%B8%E7%BB%8F%E5%85%B8%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%8C%E9%81%BF%E5%85%8D%E4%BA%86%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BA%86%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">14.2.4.3.</span> <span class="toc-text">**优点: **一种非常经典的实现，避免了分布式事务，实现了最终一致性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-%E6%B6%88%E6%81%AF%E8%A1%A8%E4%BC%9A%E8%80%A6%E5%90%88%E5%88%B0%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E4%B8%AD%EF%BC%8C%E5%A6%82%E4%BD%95%E6%B2%A1%E6%9C%89%E5%B0%81%E8%A3%85%E5%A5%BD%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%8C%E4%BC%9A%E6%9C%89%E5%BE%88%E5%A4%9A%E6%9D%82%E6%B4%BB%E9%9C%80%E8%A6%81%E5%A4%84%E7%90%86"><span class="toc-number">14.2.4.4.</span> <span class="toc-text">**缺点: **消息表会耦合到业务系统中，如何没有封装好的解决方案，会有很多杂活需要处理</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F4%E3%80%81MQ%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF"><span class="toc-number">14.2.5.</span> <span class="toc-text">方式4、MQ事务消息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-%E5%BC%82%E6%AD%A5%E5%9C%BA%E6%99%AF%E3%80%81%E9%80%9A%E7%94%A8%E6%80%A7%E8%BE%83%E5%BC%BA%E3%80%81%E6%8B%93%E5%B1%95%E6%80%A7%E8%BE%83%E9%AB%98"><span class="toc-number">14.2.6.</span> <span class="toc-text">优点:异步场景、通用性较强、拓展性较高</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A5%E9%98%BF%E9%87%8C%E7%9A%84RabbitMQ%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B8%BA%E4%BE%8B%EF%BC%8C%E6%80%9D%E8%B7%AF%E5%A4%A7%E8%87%B4%E4%B8%BA"><span class="toc-number">14.2.6.1.</span> <span class="toc-text">以阿里的RabbitMQ中间件为例，思路大致为:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E7%82%B9%EF%BC%9A%E5%AE%9E%E7%8E%B0%E4%BA%86%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%8C%E4%B8%8D%E9%9C%80%E8%A6%81%E4%BE%9D%E8%B5%96%E6%9C%AC%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1"><span class="toc-number">14.2.6.2.</span> <span class="toc-text">优点：实现了最终一致性，不需要依赖本地数据库事务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9%EF%BC%9A%E5%AE%9E%E7%8E%B0%E9%9A%BE%E5%BA%A6%E5%A4%A7%EF%BC%8C%E4%B8%BB%E6%B5%81MQ%E4%B8%8D%E6%94%AF%E6%8C%81%EF%BC%8CRocketMQ%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF%E9%83%A8%E5%88%86%E4%BB%A3%E7%A0%81%E4%B9%9F%E6%9C%AA%E5%BC%80%E6%BA%90"><span class="toc-number">14.2.6.3.</span> <span class="toc-text">缺点：实现难度大，主流MQ不支持，RocketMQ事务消息部分代码也未开源</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">14.3.</span> <span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EMQ%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%BC%98%E7%82%B9"><span class="toc-number">14.3.0.1.</span> <span class="toc-text">基于MQ的分布式事务解决方案优点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EMQ%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E7%BC%BA%E7%82%B9"><span class="toc-number">14.3.0.2.</span> <span class="toc-text">基于MQ的分布式事务解决方案缺点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BB%BA%E8%AE%AE"><span class="toc-number">14.3.0.3.</span> <span class="toc-text">建议</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/26/%E4%B8%AD%E9%97%B4%E4%BB%B6/RabbitMQ/" title="RabbitMq"><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220526162948004.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RabbitMq"/></a><div class="content"><a class="title" href="/2022/05/26/%E4%B8%AD%E9%97%B4%E4%BB%B6/RabbitMQ/" title="RabbitMq">RabbitMq</a><time datetime="2022-05-26T11:00:00.000Z" title="发表于 2022-05-26 19:00:00">2022-05-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/18/Java/JavaWeb%E5%AD%A6%E4%B9%A0/" title="JavaWeb"><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518155406212.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JavaWeb"/></a><div class="content"><a class="title" href="/2022/05/18/Java/JavaWeb%E5%AD%A6%E4%B9%A0/" title="JavaWeb">JavaWeb</a><time datetime="2022-05-18T12:16:39.000Z" title="发表于 2022-05-18 20:16:39">2022-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/18/Spring/SpringMVC%20%E5%AD%A6%E4%B9%A0/" title="SpringMVC"><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/images.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringMVC"/></a><div class="content"><a class="title" href="/2022/05/18/Spring/SpringMVC%20%E5%AD%A6%E4%B9%A0/" title="SpringMVC">SpringMVC</a><time datetime="2022-05-18T12:16:39.000Z" title="发表于 2022-05-18 20:16:39">2022-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/18/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/White-Jotter-Lv/" title="个人项目--WhiteJotter-Lv(基于SpringBoot+Vue实现的前后端分离项目)"><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220518153233950.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="个人项目--WhiteJotter-Lv(基于SpringBoot+Vue实现的前后端分离项目)"/></a><div class="content"><a class="title" href="/2022/05/18/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/White-Jotter-Lv/" title="个人项目--WhiteJotter-Lv(基于SpringBoot+Vue实现的前后端分离项目)">个人项目--WhiteJotter-Lv(基于SpringBoot+Vue实现的前后端分离项目)</a><time datetime="2022-05-18T12:16:39.000Z" title="发表于 2022-05-18 20:16:39">2022-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/17/%E6%8C%81%E4%B9%85%E5%B1%82/MyBatis/" title="Mybatis"><img src="https://raw.githubusercontent.com/hellolvweibin/Typora/main/%E4%B8%8B%E8%BD%BD.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mybatis"/></a><div class="content"><a class="title" href="/2022/05/17/%E6%8C%81%E4%B9%85%E5%B1%82/MyBatis/" title="Mybatis">Mybatis</a><time datetime="2022-05-17T12:00:00.000Z" title="发表于 2022-05-17 20:00:00">2022-05-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://raw.githubusercontent.com/hellolvweibin/Typora/main/image-20220526162948004.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Levi_Bee</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>